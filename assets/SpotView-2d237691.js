import{_ as ie,r as f,I as O,f as T,a as y,g as x,d as M,t as D,m as E,l as g,y as W,F as N,B as q,K as ce,c as J,w as $,n as C,o as le,k as ue,h as oe,G as de,H as ve,u as me,A as he}from"./index-36745a63.js";import{u as se,C as pe}from"./processDivergence-1cf10ade.js";import{b as fe,_ as be,C as ge,B as ye,P as _e,E as Ce,S as Se,T as we,D as xe,$ as Ve,g as Ie}from"./index-3fd55cfd.js";import{I as ae}from"./iconify-29fe4859.js";import{C as Le}from"./Candles-7bf57ea1.js";const ke={key:0,class:"container-selector"},Fe={key:0,class:"amount"},$e=["value","placeholder"],De=["onClick"],Be={__name:"SelectorV2",props:{lblPorDefecto:{type:String,required:!1,default:""},displayAmount:{type:Boolean,required:!1,default:!1},onlyLabel:{type:Boolean,default:!1},opciones:{type:Object,default(S){return[]}}},emits:["actionChange"],setup(S,{emit:L}){const k=L,r=S,i=f(""),e=f(!1),c=r.lblPorDefecto,a=O({data:[]});r.lblPorDefecto!==""&&(i.value=r.lblPorDefecto);const d=O({label:"",value:""}),_=n=>{const b=n.target.value.toUpperCase();i.value=b,d.label="SYMBOL",a.data=r.opciones.filter(V=>V.label.includes(b)),e.value=!0},w=()=>{e.value=!e.value},u=n=>{e.value=!1,d.label=n.label,d.value=n.value,i.value=r.onlyLabel&&r.onlyLabel.value==!0?n.label:n.value,!(!n||!n.value)&&k("actionChange",n)},B=n=>{a.data.length==0&&n!==void 0&&(a.data=n);const b=a.data.filter(V=>V.selected);b[0]&&b[0].label&&(i.value=b[0].label)};return r.opciones&&(a.data=r.opciones,B()),T(()=>r.opciones,B),(n,b)=>S.opciones&&S.opciones.length>0&&S.opciones[0].label?(y(),x("div",ke,[M("form",null,[S.displayAmount?(y(),x("span",Fe,D(S.opciones.length),1)):E("",!0),M("input",{class:"chosen-value",type:"text",value:i.value,placeholder:g(c),onInput:_,onClick:w},null,40,$e),a&&a.data?(y(),x("ul",{key:1,class:W({"value-list":!0,open:e.value})},[(y(!0),x(N,null,q(a.data,V=>(y(),x("li",{onClick:F=>u(V)},D(V.label),9,De))),256))],2)):E("",!0)])])):E("",!0)}},j=ie(Be,[["__scopeId","data-v-ff981326"]]),Me=ce({__name:"AutoCompletedComponent",props:["opciones","txt-placeholder"],setup(S){const L=S,k=L.txtPlaceholder,r=f(k),i=L.opciones;return console.log({options:i}),(e,c)=>(y(),J(g(Ie),{modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=a=>r.value=a),class:"ComboboxRoot"},{default:$(()=>[C(g(ge),{class:"ComboboxAnchor"},{default:$(()=>[C(g(fe),{class:"ComboboxInput",placeholder:g(k)},null,8,["placeholder"]),C(g(be),null,{default:$(()=>[C(g(ae),{icon:"radix-icons:chevron-down",class:"ComboboxIcon"})]),_:1})]),_:1}),C(g(Ve),{class:"ComboboxContent"},{default:$(()=>[C(g(ye),{class:"ComboboxViewport"},{default:$(()=>[C(g(_e),{class:"ComboboxEmpty"}),C(g(Ce),null,{default:$(()=>[(y(!0),x(N,null,q(g(i),(a,d)=>(y(),J(g(Se),{key:d,class:"ComboboxItem",value:a},{default:$(()=>[C(g(we),{class:"ComboboxItemIndicator"},{default:$(()=>[C(g(ae),{icon:"radix-icons:check"})]),_:1}),M("span",null,D(a),1)]),_:2},1032,["value"]))),128)),C(g(xe),{class:"ComboboxSeparator"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Ae=["id"],te={__name:"Ind",props:{ind:{type:String,required:!0,default:""}},setup(S,{expose:L}){const k=new oe,r=se(),i=S,e=f([]),c=f([]),a=f(null);let d;const _=i.ind==="rsi"?"#19f5eb":i.ind==="cci"?"yellow":"#fff",w=l=>{a.value.applyOptions({watermark:{color:_,visible:!0,text:l,fontSize:14,horzAlign:"left",vertAlign:"top"},crosshair:{mode:0,vertLine:{width:1,color:"#C3BCDB44",style:0,labelBackgroundColor:"#9B7DFF"},horzLine:{color:_,labelBackgroundColor:_}}})},u=async()=>{!a.value||!d||(i.ind==="rsi"&&(P(),d.setData(e.value)),i.ind==="cci"&&A())},B=l=>{var o;a!=null&&a.value&&((o=a==null?void 0:a.value)!=null&&o.resize)&&(l!=null&&l.width)&&(l!=null&&l.height)&&a.value.resize(l.width,l.height)},n=l=>{d!=null&&d.coordinateToPrice&&d.coordinateToPrice(l)},b=l=>{var o;i.ind=="rsi"&&a.value&&((o=a==null?void 0:a.value)!=null&&o.setCrosshairPosition)&&d&&l&&a.value.setCrosshairPosition(l,l.time,d)},V=(l,o)=>{if(o){const v=formato.filter(m=>m.time===o.time);v[0]&&histogramSeries&&a.value.setCrosshairPosition(v[0],o.time,histogramSeries);return}a.value.clearCrosshairPosition()},F=l=>{a.value.timeScale().setVisibleLogicalRange(l)},A=()=>{var l,o;if(c.value=r.chart.data.flatMap(v=>({time:v.time,value:v.cci,color:v!=null&&v.color?v.color:_})),a!=null&&a.value&&i.ind==="cci"&&((l=c==null?void 0:c.value[c.value.length-1])!=null&&l.value)){const v=parseFloat(c.value[c.value.length-1].value).toFixed(2);w(`CCI [mod 89] ${v}`),(o=c.value[c.value.length-1].value)!=null&&o.cciColor&&(c.value[c.value.length-1].value.color=c.value[c.value.length-1].value.cciColor),c.value.sort((m,U)=>m.time-U.time),d.setData(c.value)}},P=async()=>{var l;if(e.value=r.chart.data.flatMap(o=>({time:o.time,value:o.rsi})),console.log(i.ind,"RSI"),a!=null&&a.value&&((l=e==null?void 0:e.value[e.value.length-1])!=null&&l.value)){const o=e.value[e.value.length-1].value;w(`[14] ${String(i.ind).toUpperCase()} ${o}`),d.setData(e.value)}},I=()=>{const l=document.querySelector(`#chart-${i.ind}`);let o=k.getConfigChart(l.offsetWidth,l.offsetHeight);console.log({configChart:o},l.offsetWidth,l.offsetHeight),o.priceLineVisible=!1,o.priceLineColor="transparent",o.lastValueVisible=!1,o.localization={priceFormatter:v=>parseFloat(v).toFixed(2)},o.timeScale.visible=!1,o.lastValueVisible=!0,o.crosshair.mode=2,console.log({configChart:o}),a.value=pe(l,o),d=a.value.addLineSeries({color:_,lineWidth:1,priceLineVisible:!1,lineVisible:!0,crosshairMarkerVisible:!0})};return T(()=>r.chart.data,function(l){console.log("*ind* cambio Data",{dt:l}),u()}),le(async()=>{console.log("* ind",i.ind),i.ind==="rsi"?(I(),await P()):i.ind==="cci"&&(I(),await A())}),ue(()=>{console.log("desmontado",i.ind),a.value&&(a.value.removeSeries(d),a.value.remove())}),L({resize:B,refresh:u,chart:a,moveChartVisible:F,moveLineY:n,syncCrosshair:V,crossMove:b}),(l,o)=>(y(),x("div",{class:"container-indicator",id:`chart-${S.ind}`},null,8,Ae))}};const Pe={class:"charts"},Re={class:"selectors"},Te={key:0},Ee=["onClick"],Je={__name:"SpotView",setup(S,{expose:L}){const k=new oe,r=de(),i=ve(),e=se();me();const c=r.params&&r.params&&r.params.symbol?r.params.symbol.toString().toUpperCase():"BTCUSDT",a=r.params&&r.params&&r.params.temporality?r.params.temporality.toString().toLocaleLowerCase():"4h";e.chart.symbols=c,e.chart.temporality=a;const d=f([]),_=f(null),w=f(null),u=f(null),B=f(0),n=O({rsi:!1,macd:!1,cci:!1}),b=he(()=>{const t=Object.keys(n).filter(h=>n[h]),s={};return t.forEach(h=>{s[h]=n[h]}),s}),V=t=>{var h,p;const s=parseInt(t.logical);t.targetBarraIndex=s,w&&(w!=null&&w.value)&&w.value[0]&&(t!=null&&t.visibleLogicalRange)&&((h=w.value[0])!=null&&h.moveChartVisible)&&(w.value[0].moveChartVisible(t.visibleLogicalRange),w.value[0].crossMove(t.dataPoint)),u&&(u!=null&&u.value)&&u.value[0]&&(t!=null&&t.visibleLogicalRange)&&((p=u.value[0])!=null&&p.moveChartVisible)&&(u.value[0].moveChartVisible(t.visibleLogicalRange),u.value[0].crossMove(t.dataPoint))},F=()=>Object.values(n).filter(h=>h===!0).length,A=f([{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"15m",value:"15m"},{label:"30m",value:"30m"},{label:"1h",value:"1h"},{label:"2h",value:"2h"},{label:"4h",value:"4h"},{label:"6h",value:"6h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"}]),P=f([]),I=f(null),l=f(null),o=f(null),v=f(null),m=O({symbol:c,temporality:a}),U=f(!1),Y=async()=>{e.chart.data=await e.searchClandlesSpot({symbol:m.symbol,temporality:m.temporality})},ne=async()=>{const t=await e.searchSymbolsSpot();d.value=t.flatMap(s=>s.symbol.includes("USDT")?{label:s.symbol,value:s.symbol}:[]),await Y()},H=async t=>{const s=A.value.find(h=>h.label==t.label);s!=null&&s.value?(m.temporality=s.value,e.chart.temporality=m.temporality):(m.symbol=t.value,e.chart.symbols=t.value),i.push({name:"spot:data",params:{symbol:String(m.symbol).toLowerCase(),temporality:e.chart.temporality}}),o.value=null,I.value&&(m!=null&&m.symbol)&&(m!=null&&m.temporality)&&(l.value&&await I.value.send(JSON.stringify({method:"UNSUBSCRIBE",params:[`${String(l.value).toLowerCase()}`],id:1})),l.value=`${String(m.symbol).toLowerCase()}@kline_${e.chart.temporality}`,I.value.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(l.value).toLowerCase()}`],id:1})),await Y())};return window.addEventListener("resize",t=>{var h;const s=document.querySelector(".container-chart-main");(h=_==null?void 0:_.value)!=null&&h.resizeChart&&(s!=null&&s.offsetHeight)&&F()==0&&_.value.resizeChart({height:s.offsetHeight,width:s.offsetWidth,visualViewport:t.target.visualViewport})}),T(()=>"target.symbol",H),T(n,({rsi:t})=>{console.log("indicadores",{rsi:t})}),T(F,t=>{const s=document.querySelector(".container-chart-main").offsetWidth;if(t==0)_.value.resizeChart({height:document.querySelector(".container-chart-main").offsetHeight,width:s});else{const h=t==1?.7:t==2?.6:.5,p=t==1?.3:t==2?.2:.5/t,z=document.querySelector(".container-chart-main").offsetHeight-120*t;console.log({c:t,chartMainHeight:z,anchura:s,porcentajeChartMain:h,porcentajeChartIndicator:p}),_.value.resizeChart({height:z,width:s})}}),le(async()=>{I.value=await new WebSocket("wss://stream.binance.com/ws"),l.value=`${String(m.symbol).toLowerCase()}@kline_1m`,await ne(),I.value.addEventListener("open",async function(t){I.value.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(l.value).toLowerCase()}`],id:1}))}),I.value.addEventListener("message",async function(t){var s,h;if(t&&t.data&&t.data!='{"result":null,"id":1}')try{const{k:{c:p,s:z,i:Ue,h:G,l:K,x:Q,n:ze,o:X,T:Z,V:ee,v:Oe,t:re}}=JSON.parse(t.data);if(Q===!0&&(e.chart.data.push({time:parseInt(Z),timeEnd:parseInt(re),open:parseFloat(X),high:parseFloat(G),low:parseFloat(K),close:parseFloat(p),value:parseFloat(p),volume:parseFloat(ee)}),console.log({x:Q,chartcci:u},"* Cierre de vela",e.chart.data.length,new Date)),o.value=parseFloat(p).toFixed(4),v.value={time:parseInt(Z),open:parseFloat(X),high:parseFloat(G),low:parseFloat(K),close:parseFloat(p),value:parseFloat(p),volume:parseFloat(ee)},e.chart.data[e.chart.data.length-1]){e.chart.data[e.chart.data.length-1].high=v.value.high,e.chart.data[e.chart.data.length-1].low=v.value.low,e.chart.data[e.chart.data.length-1].close=v.value.close;let R=k.calcularCCI(e.chart.data,89);e.chart.data[e.chart.data.length-1].cci=parseFloat(parseFloat(R.pop()).toFixed(2))}if((s=b==null?void 0:b.value)!=null&&s.cci&&b.value.cci===!0){console.log({cci:e.chart.data[e.chart.data.length-1].cci});const R=e.chart.data[e.chart.data.length-1].cci>=100?"#00f5d4":e.chart.data[e.chart.data.length-1].cci<=-100?"#ff006e":null;R&&(v.value.color=R,v.value.borderColor=R,v.value.wickColor=R)}u&&(u!=null&&u.value)&&(u!=null&&u.value[0])&&((h=u.value[0])!=null&&h.refresh)&&u.value[0].refresh()}catch(p){console.log({evt:t,e:p})}})}),L({dataCandles:P,isRefresh:U,target:m,SelectorV2:j,dataPairs:d,dataTemporality:A,AutoCompletedComponent:Me,chartStore:e,cantidadIndicadores:B,chartIndicators:n,activeIndicators:b,cantidadIndicadoresActivos:F,Ind:te}),(t,s)=>(y(),x("main",Pe,[M("aside",null,[M("div",Re,[C(j,{opciones:d.value,onlyLabel:!1,displayAmount:!0,lblPorDefecto:g(e).chart.symbols,class:"spot-selector-symbols",onActionChange:H},null,8,["opciones","lblPorDefecto"]),C(j,{opciones:A.value,onlyLabel:!1,displayAmount:!1,lblPorDefecto:m.temporality,class:"spot-selector-temp",onActionChange:H},null,8,["opciones","lblPorDefecto"])]),o.value?(y(),x("label",Te," PRICE: "+D(o.value),1)):E("",!0),M("pre",null,D(n),1),(y(!0),x(N,null,q(n,(h,p)=>(y(),x("button",{onClick:z=>n[p]=!n[p],class:"btn btn-ind"},D(p),9,Ee))),256)),M("pre",null,D(b.value)+" ["+D(F())+"]",1)]),U.value?E("",!0):(y(),x("section",{key:0,class:W({"container-chart-main":!0,"ind-2":B.value==2})},[C(Le,{"chart-name-id":"chart-main",main:!0,ref_key:"chartMainSpot",ref:_,"data-candles":P.value,symbol:m.symbol,spot:!0,price:v.value,onCrosshairMove:V},null,8,["data-candles","symbol","price"]),(y(!0),x(N,null,q(b.value,(h,p)=>(y(),J(te,{class:W(`indicador c-ind-${F()} ind-${p}`),ind:`${p}`,"data-candles":P.value,ref_for:!0,ref:`chart${p}`},null,8,["class","ind","data-candles"]))),256))],2))]))}};export{Je as default};
