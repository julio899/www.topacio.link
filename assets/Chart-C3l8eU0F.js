import{_ as Re}from"./Selector-BDW3G8AD.js";import{V as Je}from"./lightweight-charts.production-Cq3om6Hu.js";import{u as Ue}from"./chart-K1SaxEEv.js";import{_ as He,u as $e,r as o,o as ze,c7 as qe,p as Ke,h as Ve,b as ge,d as g,e as Ze,t as F,q as W,f as Ge,k as X,i as Qe,cc as Xe,a as Le}from"./index-BxAc4Xt1.js";import{_ as Ye,a as ve,d as Se}from"./ActivadorIndicator-D8twN7tl.js";const ea={class:"container-template-chart"},aa={key:0,class:"price"},ia={class:"target-symbols"},ta={class:"target-temporality"},sa={class:"container-charts"},la={__name:"Chart",setup(ra,{expose:De}){const Y=$e(),h=new Qe;let u=null,l=null,L=null;const ye=o(null),m=o(null);let v,S,D,y,k,M,E,B,P,j,T,N,I,O,A,R,J,U,ee="#cbf078",ae="#0092ca",ie="#e84a5f",te="#a393eb",se="#defcf9",le="#35bcbf",re="#93deff";const c={bajista:[],alcista:[]},b={bajistas:[],alcistas:[]},e=Ue(),d=o(null),w=o(null),H=o(null),$=o([]),ne=o(null),p=o(0),_=o(!1),z=Xe();o(null),o(null);const ke=Se(()=>new Promise((a,i)=>{c.bajista.length>0&&c.bajista.forEach(t=>{let s=l.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});s.setData(t),b.bajistas.push(s)}),c.alcista.length>0&&c.alcista.forEach(t=>{let s=l.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});s.setData(t),b.alcistas.push(s)}),a(!0)}),500),oe=a=>{a.setData([])},q=()=>new Promise((a,i)=>{c.alcista.length>0&&b.alcistas.forEach(oe),c.bajista.length>0&&b.bajistas.forEach(oe),c.alcista=[],c.bajista=[],console.log("resetDivergences: indicators.divergences",e.chart.indicators.divergences),a(!0)}),Me=async()=>{const a=w.value.offsetHeight,i=w.value.offsetWidth,t=h.getConfigChart(i,a),s=h.getConfigVelasTransparentes();l=Je(w.value,t),u=l.addCandlestickSeries(s),y=l.addLineSeries({color:"#f6483e33",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),k=l.addLineSeries({color:"#f0f8ff8f",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),M=l.addLineSeries({color:"#00ffa521",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),E=l.addLineSeries({color:"#84ff3d8a",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),B=l.addLineSeries({color:"orange",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),P=l.addLineSeries({color:"#f70776",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),j=l.addLineSeries({color:"#00bbf0",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),T=l.addLineSeries({color:"#bae8e8",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),N=l.addLineSeries({color:ee,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),I=l.addLineSeries({color:ae,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),O=l.addLineSeries({color:ie,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),A=l.addLineSeries({color:te,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),R=l.addLineSeries({color:se,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),J=l.addLineSeries({color:le,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),U=l.addLineSeries({color:re,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),v=l.addLineSeries({color:"yellow",lineWidth:4,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),S=l.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),D=l.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),H.value=l.addHistogramSeries({lastValueVisible:!1,priceLineVisible:!1,priceFormat:{type:"volume"},priceScaleId:"volumen"}),H.value.priceScale().applyOptions({priceFormat:{type:"volume"},scaleMargins:{top:.85,bottom:0}});const r=(await e.searchSymbolsFutures()).flatMap(f=>e.chart.symbols!=f.symbol?{label:f.symbol,value:f.symbol}:{label:f.symbol,value:f.symbol,selected:!0});$.value=r.filter(f=>f.value.includes("USDT"));const C=String(e.getSymbol).toLowerCase();L=await new WebSocket(`wss://fstream.binance.com/ws/${C}@kline_${e.getTemporality}`),L.addEventListener("open",f=>{console.log("* open",{event:f})}),L.addEventListener("message",Ce),de(),l.timeScale().subscribeVisibleLogicalRangeChange(_e),l.subscribeCrosshairMove(we),window.addEventListener("resize",ce)},Ce=async a=>{var i;if(a!=null&&a.data){const t=JSON.parse(a.data);if(!t||!((i=t==null?void 0:t.k)!=null&&i.c))return;const s=parseFloat(t.k.c);t.k.T&&parseInt(t.k.T),t.k.x&&t.k.x;const n=t.k.V?parseFloat(t.k.V):null;if(t.s==e.getSymbol&&e.getTemporality==t.k.i){const r={time:parseInt(t.k.T),open:parseFloat(t.k.o),high:parseFloat(t.k.h),low:parseFloat(t.k.l),close:s,value:s,volume:n};u.update(r),p.value=s}}},We=(a,i)=>i.time&&i.seriesData.get(a)||null,we=a=>{var t;const i=We(u,a);m!=null&&m.value&&((t=m==null?void 0:m.value)!=null&&t.syncCrosshair)&&i&&m.value.syncCrosshair(u,i)},_e=({from:a})=>{const i=l.timeScale().getVisibleLogicalRange(),t=l.timeScale().getVisibleRange(),s=parseInt(l.timeScale().scrollPosition());if(ye.value={visibleLogicalRange:i,visibleRange:t,scrollPosition:s,t:Date.now()},a&&a<100&&!_.value){console.log("*a buscar",_.value),_.value=!0;let n=e.chart.data[0].time;d.value.postMessage({command:"searchDataPrevius",data:{exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci,endTime:n}})}},ce=()=>{},x=()=>{if(y.setData([]),M.setData([]),k.setData([]),!e.chart.indicators.bb)return;const a=e.chart.data.flatMap(s=>{let n={value:s.bb.upper,time:s.time};return s.high>s.bb.upper&&(n.color="#f443369e"),n}),i=e.chart.data.flatMap(s=>{let n={value:s.bb.lower,time:s.time};return s.low<s.bb.lower&&(n.color="#00ffa58a"),n}),t=e.chart.data.flatMap(s=>({value:s.bb.middle,time:s.time}));a.sort((s,n)=>s.time-n.time),i.sort((s,n)=>s.time-n.time),t.sort((s,n)=>s.time-n.time),y.setData(a),M.setData(i),k.setData(t)},xe=()=>{v.setData([]),S.setData([]),D.setData([]),q(),x(),b.bajistas=[],b.alcistas=[],console.log("***",{leneasRenderDivergences:b}),fe()};ze(()=>{d.value=new Worker(new URL("/assets/chartWorker-DBZtpi4n.js",import.meta.url),{type:"module"}),Me(),d.value.onmessage=({data:{response:a,data:i,ema:t}})=>{if(a==="ema")return Oe({data:i,ema:t});if(a==="searchData"&&(e.chart.data=i,u.setData(i),xe(),Q(),e.chart.indicators.divergences&&d.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))})),a==="responseProcessDivergence"&&i&&(console.log({response:a,data:i}),i.bajista?c.bajista=i.bajista:c.bajista=[],i.alcista?c.alcista=i.alcista:c.alcista=[],ke()),a==="searchDataPrevius"){const s=[].concat(i.toSpliced(-1),e.chart.data);return e.chart.data=s,u.setData(s),Q(),new Promise((n,r)=>{x(),fe(),e.chart.indicators.divergences&&d.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.kernelChannel?me():(v.setData([]),S.setData([]),D.setData([])),pe(),_.value=!1,n(!0)})}},ne.value=setInterval(Pe,1e3)}),qe(()=>{d.value.terminate(),clearInterval(ne.value),window.removeEventListener("resize")});const Fe=()=>{const i=`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`;L.send(JSON.stringify({method:"UNSUBSCRIBE",params:[i],id:new Date().getTime()}))},Ee=()=>{de(),L.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`],id:1}))},K=async a=>{be(),await Fe(),Y.loading=!0,p.value=null,console.log(e.getSymbol,"*",e.getTemporality),e.setSymbol(a.value),await Ee(),Y.loading=!1},Be=a=>{const i=a.map(r=>r.value),t=i.reduce((r,C)=>r+C,0)/i.length;i.forEach(r=>{});const s=parseInt(t*2.5);return a.flatMap(r=>(r.value>=s&&(r.color="#96EFFF"),r))},Pe=()=>{new Date().toLocaleString()},fe=()=>{const a=e.chart.data.flatMap(t=>({time:t.time,value:t.volume,color:"#d1e1e159"})),i=Be(a);H.value.setData(i)},de=()=>{d.value.postMessage({command:"searchData",data:{exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci}})},Z=Ke(()=>p.value?p.value>.01?parseFloat(p.value).toFixed(4):parseFloat(p.value).toFixed(6):""),je=z.params&&z.params.temporality?z.params.temporality.toString().toLocaleLowerCase():"4h",Te=[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"30m",label:"30m"},{value:"1h",label:"1h"},{value:"2h",label:"2h"},{value:"4h",label:"4h"},{value:"1d",label:"1d"},{value:"3d",label:"3d"},{value:"1w",label:"1w"}],he=async a=>{e.chart.temporality=a.value,K({value:String(e.getSymbol)})},ue=o(Te.flatMap(a=>je==a.label?{value:a.value,label:a.label,selected:!0}:{value:a.value,label:a.label})),G=o("15m"),me=()=>{const i=h.kernelChannel(e.chart.data,89,3.5),t=i.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.upperChannel).toFixed(4))})),s=i.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.lowerChannel).toFixed(4))})),n=i.flatMap((r,C)=>{const f=parseFloat(r.smoothedData)<e.chart.data[C].close?"#A6FF96":"#DA0C81";return{time:r.time,value:parseFloat(parseFloat(r.smoothedData).toFixed(4)),color:f}});v.setData(n),S.setData(t),D.setData(s)},Ne=Se(()=>{new Promise((a,i)=>(e.getcustomOption&&(d.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.kernelChannel&&me(),e.chart.indicators.bb&&x()),a(!0))),console.log("checkCustomIndicators")},500);Ve(e.getcustomOption,a=>{a?Ne():(v.setData([]),S.setData([]),D.setData([]),y.setData([]),M.setData([]),k.setData([]),q(),console.log(e.getcustomOption,"clear")),console.log("*cambio",{status:a})});const be=()=>{q(),E.setData([]),B.setData([]),P.setData([]),j.setData([]),T.setData([]),y.setData([]),M.setData([]),k.setData([])},pe=()=>{if(be(),e.chart.indicators.divergences&&d.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.bb&&x(),e.chart.indicators.hma10){const a=h.calculateHMA(e.chart.data,10);E.setData(a)}if(e.chart.indicators.hma20){const a=h.calculateHMA(e.chart.data,20,"#FF9D23");B.setData(a)}if(e.chart.indicators.hma55){const a=h.calculateHMA(e.chart.data,55,"#ff5733");P.setData(a)}if(e.chart.indicators.hma89){const a=h.calculateHMA(e.chart.data,89,"#9896f1");j.setData(a)}if(e.chart.indicators.hma233){const a=h.calculateHMA(e.chart.data,233,"#00bbf0");T.setData(a)}},Ie=a=>{l&&l.setCrosshairPosition(a,a.time,u)},Oe=({data:a,ema:i})=>{if(i===10)return N.setData(a);if(i===20)return I.setData(a);if(i===55)return O.setData(a);if(i===89)return A.setData(a);if(i===100)return R.setData(a);if(i===200)return J.setData(a);if(i===233)return U.setData(a)},V=(a,i="#fff")=>{d.value.postMessage({command:"calculateEma",data:JSON.parse(JSON.stringify(e.chart.data)),ema:a,color:i})},Ae=()=>{e.chart.indicators.ema10||N.setData([]),e.chart.indicators.ema20||I.setData([]),e.chart.indicators.ema55||O.setData([]),e.chart.indicators.ema89||A.setData([]),e.chart.indicators.ema100||R.setData([]),e.chart.indicators.ema200||J.setData([]),e.chart.indicators.ema233||U.setData([])},Q=()=>{Ae(),e.chart.indicators.ema10&&V(10,ee),e.chart.indicators.ema20&&V(20,ae),e.chart.indicators.ema55&&V(55,ie),e.chart.indicators.ema89&&V(89,te),e.chart.indicators.ema100&&V(100,se),e.chart.indicators.ema200&&V(200,le),e.chart.indicators.ema233&&V(233,re)};return Ve(e.chart.indicators,()=>{pe(),Q()}),De({chartStore:e,dataPairs:$,lastPrice:p,formatPrice:Z,temporalityData:ue,targetTemporality:G,ChartMacd:Ye,ActivadorIndicator:ve,changeTemporality:he,changeTarget:K,syncCrosshairMACD:Ie,resize:ce}),(a,i)=>{const t=Re;return Le(),ge("div",ea,[g("h1",null,[Ze(F(W(e).getSymbol)+" "+F(W(e).getTemporality)+" ",1),Z.value?(Le(),ge("span",aa,"price: "+F(Z.value),1)):Ge("",!0)]),g("article",null,[g("div",ia,[X(t,{opciones:$.value,onlyLabel:!1,lblPorDefecto:W(e).chart.symbols,onActionChange:K},null,8,["opciones","lblPorDefecto"])]),g("div",ta,[X(t,{lblPorDefecto:W(e).getTemporality,opciones:ue.value,onlyLabel:!1,modelValue:G.value,"onUpdate:modelValue":i[0]||(i[0]=s=>G.value=s),onActionChange:he},null,8,["lblPorDefecto","opciones","modelValue"])]),g("pre",null,"        "+F(W(e).chart.indicators)+`
      `,1)]),g("div",sa,[g("section",{id:"chart-principal",ref_key:"chartElement",ref:w},[X(ve)],512)])])}}},ha=He(la,[["__scopeId","data-v-d02d3553"]]);export{ha as default};
