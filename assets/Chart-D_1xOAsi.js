import{_ as Je}from"./Selector-DAROikaF.js";import{V as Re}from"./lightweight-charts.production-Cq3om6Hu.js";import{u as Ue}from"./chart-BoXn26jO.js";import{_ as He,u as $e,r as c,o as ze,c8 as qe,p as Ke,h as Le,b as P,d as h,e as Ze,t as w,q as u,f as Ge,k as te,i as Qe,cg as Xe,a as T}from"./index-CplsA7WG.js";import{_ as Ye,a as ve,d as Se}from"./ActivadorIndicator-DdjGVgnB.js";const ea={class:"container-template-chart"},aa={key:0,class:"price"},ta={class:"target-symbols"},ia={class:"target-temporality"},sa={class:"btn-spot-futures"},la={class:"container-charts"},ra={__name:"Chart",setup(na,{expose:De}){const ie=$e(),b=new Qe;let m=null,s=null,S=null;const ye=c(null),p=c(null);let D,y,k,M,C,W,j,B,N,I,O,A,J,R,U,H,$,z,se="#cbf078",le="#0092ca",re="#e84a5f",ne="#a393eb",oe="#defcf9",ce="#35bcbf",fe="#93deff";const f={bajista:[],alcista:[]},g={bajistas:[],alcistas:[]},e=Ue(),o=c(null),x=c(null),q=c(null),K=c([]),de=c(null),V=c(0),_=c(!1),Z=Xe();c(null),c(null);const ke=Se(()=>new Promise((a,t)=>{f.bajista.length>0&&f.bajista.forEach(l=>{let i=s.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});i.setData(l),g.bajistas.push(i)}),f.alcista.length>0&&f.alcista.forEach(l=>{let i=s.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});i.setData(l),g.alcistas.push(i)}),a(!0)}),500),ue=a=>{a.setData([])},G=()=>new Promise((a,t)=>{f.alcista.length>0&&g.alcistas.forEach(ue),f.bajista.length>0&&g.bajistas.forEach(ue),f.alcista=[],f.bajista=[],console.log("resetDivergences: indicators.divergences",e.chart.indicators.divergences),a(!0)}),Me=async()=>{const a=x.value.offsetHeight,t=x.value.offsetWidth,l=b.getConfigChart(t,a),i=b.getConfigVelasTransparentes();s=Re(x.value,l),m=s.addCandlestickSeries(i),M=s.addLineSeries({color:"#f6483e33",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),C=s.addLineSeries({color:"#f0f8ff8f",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),W=s.addLineSeries({color:"#00ffa521",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),j=s.addLineSeries({color:"#84ff3d8a",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),B=s.addLineSeries({color:"orange",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),N=s.addLineSeries({color:"#f70776",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),I=s.addLineSeries({color:"#00bbf0",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),O=s.addLineSeries({color:"#bae8e8",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),A=s.addLineSeries({color:se,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),J=s.addLineSeries({color:le,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),R=s.addLineSeries({color:re,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),U=s.addLineSeries({color:ne,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),H=s.addLineSeries({color:oe,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),$=s.addLineSeries({color:ce,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),z=s.addLineSeries({color:fe,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),D=s.addLineSeries({color:"yellow",lineWidth:4,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),y=s.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),k=s.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),q.value=s.addHistogramSeries({lastValueVisible:!1,priceLineVisible:!1,priceFormat:{type:"volume"},priceScaleId:"volumen"}),q.value.priceScale().applyOptions({priceFormat:{type:"volume"},scaleMargins:{top:.85,bottom:0}});const r=(await e.searchSymbols()).flatMap(d=>e.chart.symbols!=d.symbol?{label:d.symbol,value:d.symbol}:{label:d.symbol,value:d.symbol,selected:!0});K.value=r;const v=String(e.getSymbol).toLowerCase();S=await new WebSocket(`wss://fstream.binance.com/ws/${v}@kline_${e.getTemporality}`),S.addEventListener("open",d=>{console.log("* open",{event:d})}),S.addEventListener("message",Ce),E(),s.timeScale().subscribeVisibleLogicalRangeChange(xe),s.subscribeCrosshairMove(we),window.addEventListener("resize",Q)},Ce=async a=>{var t,l;if(a!=null&&a.data){const i=JSON.parse(a.data);if(!i||!((t=i==null?void 0:i.k)!=null&&t.c))return;const n=parseFloat(i.k.c);i.k.T&&parseInt(i.k.T);const r=i.k.x?i.k.x:!1,v=i.k.V?parseFloat(i.k.V):null;if(i.s==e.getSymbol&&e.getTemporality==i.k.i){const d={time:parseInt(i.k.T),open:parseFloat(i.k.o),high:parseFloat(i.k.h),low:parseFloat(i.k.l),close:n,value:n,volume:v};m.update(d),V.value=n}r&&((l=o==null?void 0:o.value)!=null&&l.postMessage)&&(console.log({xClosed:r},e.chart.data.length),E())}},We=(a,t)=>t.time&&t.seriesData.get(a)||null,we=a=>{var l;const t=We(m,a);p!=null&&p.value&&((l=p==null?void 0:p.value)!=null&&l.syncCrosshair)&&t&&p.value.syncCrosshair(m,t)},xe=({from:a})=>{const t=s.timeScale().getVisibleLogicalRange(),l=s.timeScale().getVisibleRange(),i=parseInt(s.timeScale().scrollPosition());if(ye.value={visibleLogicalRange:t,visibleRange:l,scrollPosition:i,t:Date.now()},a&&a<100&&!_.value){console.log("*a buscar",_.value),_.value=!0;let n=e.chart.data[0].time;o.value.postMessage({command:"searchDataPrevius",data:{exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci,endTime:n,type:e.chart.futures?"futures":"spot"}})}},Q=()=>{},F=()=>{if(M.setData([]),W.setData([]),C.setData([]),!e.chart.indicators.bb)return;const a=e.chart.data.flatMap(i=>{let n={value:i.bb.upper,time:i.time};return i.high>i.bb.upper&&(n.color="#f443369e"),n}),t=e.chart.data.flatMap(i=>{let n={value:i.bb.lower,time:i.time};return i.low<i.bb.lower&&(n.color="#00ffa58a"),n}),l=e.chart.data.flatMap(i=>({value:i.bb.middle,time:i.time}));a.sort((i,n)=>i.time-n.time),t.sort((i,n)=>i.time-n.time),l.sort((i,n)=>i.time-n.time),M.setData(a),W.setData(t),C.setData(l)},_e=()=>{D.setData([]),y.setData([]),k.setData([]),G(),F(),g.bajistas=[],g.alcistas=[],console.log("***",{leneasRenderDivergences:g}),he()};ze(()=>{o.value=new Worker(new URL("/assets/chartWorker-DiUEZgWS.js",import.meta.url),{type:"module"}),Me(),o.value.onmessage=({data:{response:a,data:t,ema:l}})=>{if(a==="cci"){const i=e.chart.data.slice(t.length*-1);console.log({PENDIENTE:"debugear el calculo de cci",response:a,data:t,ultimosDeDataCandles:i},e.chart.data[e.chart.data.length-1],e.chart.data.length)}if(a==="ema")return Oe({data:t,ema:l});if(a==="searchData"&&(e.chart.data=t,m.setData(t),_e(),ae(),e.chart.indicators.divergences&&o.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))})),a==="responseProcessDivergence"&&t&&(console.log({response:a,data:t}),t.bajista?f.bajista=t.bajista:f.bajista=[],t.alcista?f.alcista=t.alcista:f.alcista=[],ke()),a==="searchDataPrevius"){const i=[].concat(t.toSpliced(-1),e.chart.data);return e.chart.data=i,m.setData(i),ae(),new Promise((n,r)=>{F(),he(),e.chart.indicators.divergences&&o.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.kernelChannel?pe():(D.setData([]),y.setData([]),k.setData([])),Ve(),_.value=!1,n(!0)})}},de.value=setInterval(Te,1e3)}),qe(()=>{window.removeEventListener("resize",Q,!0),clearInterval(de.value),o.value.terminate()});const Fe=()=>{const t=`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`;S.send(JSON.stringify({method:"UNSUBSCRIBE",params:[t],id:new Date().getTime()}))},Ee=()=>{E(),S.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`],id:1}))},X=async a=>{ge(),await Fe(),ie.loading=!0,V.value=null,console.log(e.getSymbol,"*",e.getTemporality),e.setSymbol(a.value),await Ee(),ie.loading=!1},Pe=a=>{const t=a.map(r=>r.value),l=t.reduce((r,v)=>r+v,0)/t.length;t.forEach(r=>{});const i=parseInt(l*2.5);return a.flatMap(r=>(r.value>=i&&(r.color="#96EFFF"),r))},Te=()=>{new Date().toLocaleString()},he=()=>{const a=e.chart.data.flatMap(l=>({time:l.time,value:l.volume,color:"#d1e1e159"})),t=Pe(a);q.value.setData(t)},E=()=>{o.value.postMessage({command:"searchData",data:{exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci,type:e.chart.futures?"futures":"spot"}})},Y=Ke(()=>V.value?V.value>.01?parseFloat(V.value).toFixed(4):parseFloat(V.value).toFixed(6):""),je=Z.params&&Z.params.temporality?Z.params.temporality.toString().toLocaleLowerCase():"4h",Be=[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"30m",label:"30m"},{value:"1h",label:"1h"},{value:"2h",label:"2h"},{value:"4h",label:"4h"},{value:"1d",label:"1d"},{value:"3d",label:"3d"},{value:"1w",label:"1w"}],be=async a=>{e.chart.temporality=a.value,X({value:String(e.getSymbol)})},me=c(Be.flatMap(a=>je==a.label?{value:a.value,label:a.label,selected:!0}:{value:a.value,label:a.label})),ee=c("15m"),pe=()=>{const t=b.kernelChannel(e.chart.data,89,3.5),l=t.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.upperChannel).toFixed(4))})),i=t.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.lowerChannel).toFixed(4))})),n=t.flatMap((r,v)=>{const d=parseFloat(r.smoothedData)<e.chart.data[v].close?"#A6FF96":"#DA0C81";return{time:r.time,value:parseFloat(parseFloat(r.smoothedData).toFixed(4)),color:d}});D.setData(n),y.setData(l),k.setData(i)},Ne=Se(()=>{new Promise((a,t)=>(e.getcustomOption&&(o.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.kernelChannel&&pe(),e.chart.indicators.bb&&F()),a(!0))),console.log("checkCustomIndicators")},500);Le(e.getcustomOption,a=>{a?Ne():(D.setData([]),y.setData([]),k.setData([]),M.setData([]),W.setData([]),C.setData([]),G(),console.log(e.getcustomOption,"clear")),console.log("*cambio",{status:a})});const ge=()=>{console.log("preclearIndicator"),G(),j.setData([]),B.setData([]),N.setData([]),I.setData([]),O.setData([]),M.setData([]),W.setData([]),C.setData([])},Ve=()=>{if(console.log("checkActiveIndicator"),ge(),e.chart.indicators.cci&&o.value.postMessage({command:"calculateCCI",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.divergences&&o.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.bb&&F(),e.chart.indicators.hma10){const a=b.calculateHMA(e.chart.data,10);j.setData(a)}if(e.chart.indicators.hma20){const a=b.calculateHMA(e.chart.data,20,"#FF9D23");B.setData(a)}if(e.chart.indicators.hma55){const a=b.calculateHMA(e.chart.data,55,"#ff5733");N.setData(a)}if(e.chart.indicators.hma89){const a=b.calculateHMA(e.chart.data,89,"#9896f1");I.setData(a)}if(e.chart.indicators.hma233){const a=b.calculateHMA(e.chart.data,233,"#00bbf0");O.setData(a)}},Ie=a=>{s&&s.setCrosshairPosition(a,a.time,m)},Oe=({data:a,ema:t})=>{if(t===10)return A.setData(a);if(t===20)return J.setData(a);if(t===55)return R.setData(a);if(t===89)return U.setData(a);if(t===100)return H.setData(a);if(t===200)return $.setData(a);if(t===233)return z.setData(a)},L=(a,t="#fff")=>{o.value.postMessage({command:"calculateEma",data:JSON.parse(JSON.stringify(e.chart.data)),ema:a,color:t})},Ae=()=>{e.chart.indicators.ema10||A.setData([]),e.chart.indicators.ema20||J.setData([]),e.chart.indicators.ema55||R.setData([]),e.chart.indicators.ema89||U.setData([]),e.chart.indicators.ema100||H.setData([]),e.chart.indicators.ema200||$.setData([]),e.chart.indicators.ema233||z.setData([])},ae=()=>{Ae(),e.chart.indicators.ema10&&L(10,se),e.chart.indicators.ema20&&L(20,le),e.chart.indicators.ema55&&L(55,re),e.chart.indicators.ema89&&L(89,ne),e.chart.indicators.ema100&&L(100,oe),e.chart.indicators.ema200&&L(200,ce),e.chart.indicators.ema233&&L(233,fe)};return Le(e.chart.indicators,(a,t)=>{E(),console.log("watch chartStore.chart.indicators",{n:a.cci,o:t.cci,dt:a,old:t}),Ve(),ae()}),De({chartStore:e,dataPairs:K,lastPrice:V,formatPrice:Y,temporalityData:me,targetTemporality:ee,ChartMacd:Ye,ActivadorIndicator:ve,changeTemporality:be,changeTarget:X,syncCrosshairMACD:Ie,resize:Q}),(a,t)=>{const l=Je;return T(),P("div",ea,[h("h1",null,[Ze(w(u(e).getSymbol)+" "+w(u(e).getTemporality)+" ",1),Y.value?(T(),P("span",aa,"price: "+w(Y.value),1)):Ge("",!0)]),h("article",null,[h("div",ta,[te(l,{opciones:K.value,onlyLabel:!1,lblPorDefecto:u(e).chart.symbols,onActionChange:X},null,8,["opciones","lblPorDefecto"])]),h("div",ia,[te(l,{lblPorDefecto:u(e).getTemporality,opciones:me.value,onlyLabel:!1,modelValue:ee.value,"onUpdate:modelValue":t[0]||(t[0]=i=>ee.value=i),onActionChange:be},null,8,["lblPorDefecto","opciones","modelValue"])]),h("p",sa,[u(e).chart.futures?(T(),P("span",{key:0,class:"btn-t bnt2",onClick:t[1]||(t[1]=(...i)=>u(e).toogleFutures&&u(e).toogleFutures(...i))},"FUTURES")):(T(),P("span",{key:1,class:"btn-t bnt2",onClick:t[2]||(t[2]=(...i)=>u(e).toogleFutures&&u(e).toogleFutures(...i))},"SPOT")),h("span",null,w(u(e).getExchange),1)]),h("pre",null,"        "+w(u(e).chart.indicators)+`
      `,1)]),h("div",la,[h("section",{id:"chart-principal",ref_key:"chartElement",ref:x},[te(ve)],512)])])}}},ha=He(ra,[["__scopeId","data-v-9f4dd103"]]);export{ha as default};
