import{_ as ce,r as p,I as O,f as T,a as _,g as L,d as B,t as D,m as E,l as g,y as j,F as N,B as W,K as ue,c as J,w as $,n as S,o as oe,k as de,h as se,G as ve,H as he,u as me,A as pe}from"./index-5d3a633f.js";import{u as ne,C as fe}from"./processDivergence-7265d4b4.js";import{b as be,_ as ge,C as ye,B as _e,P as Ce,E as Se,S as we,T as xe,D as Le,$ as Ve,g as Ie}from"./index-5f874ed0.js";import{I as te}from"./iconify-1b71e761.js";import{C as ke}from"./Candles-dfa9436f.js";const Fe={key:0,class:"container-selector"},$e={key:0,class:"amount"},De=["value","placeholder"],Be=["onClick"],Pe={__name:"SelectorV2",props:{lblPorDefecto:{type:String,required:!1,default:""},displayAmount:{type:Boolean,required:!1,default:!1},onlyLabel:{type:Boolean,default:!1},opciones:{type:Object,default(w){return[]}}},emits:["actionChange"],setup(w,{emit:I}){const k=I,i=w,r=p(""),a=p(!1),c=i.lblPorDefecto,e=O({data:[]});i.lblPorDefecto!==""&&(r.value=i.lblPorDefecto);const n=O({label:"",value:""}),C=f=>{const d=f.target.value.toUpperCase();r.value=d,n.label="SYMBOL",e.data=i.opciones.filter(y=>y.label.includes(d)),a.value=!0},x=()=>{a.value=!a.value},u=f=>{a.value=!1,n.label=f.label,n.value=f.value,r.value=i.onlyLabel&&i.onlyLabel.value==!0?f.label:f.value,!(!f||!f.value)&&k("actionChange",f)},P=f=>{e.data.length==0&&f!==void 0&&(e.data=f);const d=e.data.filter(y=>y.selected);d[0]&&d[0].label&&(r.value=d[0].label)};return i.opciones&&(e.data=i.opciones,P()),T(()=>i.opciones,P),(f,d)=>w.opciones&&w.opciones.length>0&&w.opciones[0].label?(_(),L("div",Fe,[B("form",null,[w.displayAmount?(_(),L("span",$e,D(w.opciones.length),1)):E("",!0),B("input",{class:"chosen-value",type:"text",value:r.value,placeholder:g(c),onInput:C,onClick:x},null,40,De),e&&e.data?(_(),L("ul",{key:1,class:j({"value-list":!0,open:a.value})},[(_(!0),L(N,null,W(e.data,y=>(_(),L("li",{onClick:U=>u(y)},D(y.label),9,Be))),256))],2)):E("",!0)])])):E("",!0)}},H=ce(Pe,[["__scopeId","data-v-ff981326"]]),Me=ue({__name:"AutoCompletedComponent",props:["opciones","txt-placeholder"],setup(w){const I=w,k=I.txtPlaceholder,i=p(k),r=I.opciones;return(a,c)=>(_(),J(g(Ie),{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=e=>i.value=e),class:"ComboboxRoot"},{default:$(()=>[S(g(ye),{class:"ComboboxAnchor"},{default:$(()=>[S(g(be),{class:"ComboboxInput",placeholder:g(k)},null,8,["placeholder"]),S(g(ge),null,{default:$(()=>[S(g(te),{icon:"radix-icons:chevron-down",class:"ComboboxIcon"})]),_:1})]),_:1}),S(g(Ve),{class:"ComboboxContent"},{default:$(()=>[S(g(_e),{class:"ComboboxViewport"},{default:$(()=>[S(g(Ce),{class:"ComboboxEmpty"}),S(g(Se),null,{default:$(()=>[(_(!0),L(N,null,W(g(r),(e,n)=>(_(),J(g(we),{key:n,class:"ComboboxItem",value:e},{default:$(()=>[S(g(xe),{class:"ComboboxItemIndicator"},{default:$(()=>[S(g(te),{icon:"radix-icons:check"})]),_:1}),B("span",null,D(e),1)]),_:2},1032,["value"]))),128)),S(g(Le),{class:"ComboboxSeparator"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Ae=["id"],le={__name:"Ind",props:{ind:{type:String,required:!0,default:""}},setup(w,{expose:I}){const k=new se,i=ne(),r=w,a=p([]),c=p([]),e=p(null);let n;const C=r.ind==="rsi"?"#19f5eb":r.ind==="cci"?"yellow":"#fff",x=t=>{e.value.applyOptions({watermark:{color:C,visible:!0,text:t,fontSize:14,horzAlign:"left",vertAlign:"top"},crosshair:{mode:0,vertLine:{width:1,color:"#C3BCDB44",style:0,labelBackgroundColor:"#9B7DFF"},horzLine:{color:C,labelBackgroundColor:C}}})},u=async()=>{!e.value||!n||(r.ind==="rsi"&&(M(),n.setData(a.value)),r.ind==="cci"&&F())},P=t=>{var o;e!=null&&e.value&&((o=e==null?void 0:e.value)!=null&&o.resize)&&(t!=null&&t.width)&&(t!=null&&t.height)&&e.value.resize(t.width,t.height)},f=t=>{n!=null&&n.coordinateToPrice&&n.coordinateToPrice(t)},d=t=>{var o;r.ind=="rsi"&&e.value&&((o=e==null?void 0:e.value)!=null&&o.setCrosshairPosition)&&n&&t&&e.value.setCrosshairPosition(t,t.time,n)},y=(t,o)=>{if(o){const b=formato.filter(V=>V.time===o.time);b[0]&&histogramSeries&&e.value.setCrosshairPosition(b[0],o.time,histogramSeries);return}e.value.clearCrosshairPosition()},U=t=>{e.value.timeScale().setVisibleLogicalRange(t)},F=()=>{var t,o;if(c.value=i.chart.data.flatMap(b=>({time:b.time,value:b.cci,color:b!=null&&b.color?b.color:C})),e!=null&&e.value&&r.ind==="cci"&&((t=c==null?void 0:c.value[c.value.length-1])!=null&&t.value)){const b=parseFloat(c.value[c.value.length-1].value).toFixed(2);x(`CCI [mod 89] ${b}`),(o=c.value[c.value.length-1].value)!=null&&o.cciColor&&(c.value[c.value.length-1].value.color=c.value[c.value.length-1].value.cciColor),c.value.sort((V,m)=>V.time-m.time),n.setData(c.value)}},M=async()=>{var t;if(a.value=i.chart.data.flatMap(o=>({time:o.time,value:o.rsi})),console.log(r.ind,"RSI"),e!=null&&e.value&&((t=a==null?void 0:a.value[a.value.length-1])!=null&&t.value)){const o=a.value[a.value.length-1].value;x(`[14] ${String(r.ind).toUpperCase()} ${o}`),n.setData(a.value)}},A=()=>{const t=document.querySelector(`#chart-${r.ind}`);let o=k.getConfigChart(t.offsetWidth,t.offsetHeight);console.log({configChart:o},t.offsetWidth,t.offsetHeight),o.priceLineVisible=!1,o.priceLineColor="transparent",o.lastValueVisible=!1,o.localization={priceFormatter:b=>parseFloat(b).toFixed(2)},o.timeScale.visible=!1,o.lastValueVisible=!0,o.crosshair.mode=2,console.log({configChart:o}),e.value=fe(t,o),n=e.value.addLineSeries({color:C,lineWidth:1,priceLineVisible:!1,lineVisible:!0,crosshairMarkerVisible:!0}),r.ind==="cci"&&n&&(n.createPriceLine({price:100,color:"#26a69a",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:"100"}),n.createPriceLine({price:0,color:"#c1c1c1",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:"0"}),n.createPriceLine({price:-100,color:"#ffb3c6",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:"-100"}))};return T(()=>i.chart.data,function(t){console.log("*ind* cambio Data",{dt:t}),u()}),oe(async()=>{console.log("* ind",r.ind),r.ind==="rsi"?(A(),await M()):r.ind==="cci"&&(A(),await F())}),de(()=>{console.log("desmontado",r.ind),e.value&&(e.value.removeSeries(n),e.value.remove())}),I({resize:P,refresh:u,chart:e,moveChartVisible:U,moveLineY:f,syncCrosshair:y,crossMove:d}),(t,o)=>(_(),L("div",{class:"container-indicator",id:`chart-${w.ind}`},null,8,Ae))}};const Re={class:"charts"},Te={class:"selectors"},Ee={key:0},Ue=["onClick"],Ye={__name:"SpotView",setup(w,{expose:I}){const k=new se,i=ve(),r=he(),a=ne();me();const c=i.params&&i.params&&i.params.symbol?i.params.symbol.toString().toUpperCase():"BTCUSDT",e=i.params&&i.params&&i.params.temporality?i.params.temporality.toString().toLocaleLowerCase():"4h";a.chart.symbols=c,a.chart.temporality=e;const n=p([]),C=p(null),x=p(null),u=p(null),P=p(89),f=p(0),d=O({cci:!1}),y=pe(()=>{const l=Object.keys(d).filter(v=>d[v]),s={};return l.forEach(v=>{s[v]=d[v]}),s}),U=l=>{var v,h;const s=parseInt(l.logical);l.targetBarraIndex=s,x&&(x!=null&&x.value)&&x.value[0]&&(l!=null&&l.visibleLogicalRange)&&((v=x.value[0])!=null&&v.moveChartVisible)&&(x.value[0].moveChartVisible(l.visibleLogicalRange),x.value[0].crossMove(l.dataPoint)),u&&(u!=null&&u.value)&&u.value[0]&&(l!=null&&l.visibleLogicalRange)&&((h=u.value[0])!=null&&h.moveChartVisible)&&(u.value[0].moveChartVisible(l.visibleLogicalRange),u.value[0].crossMove(l.dataPoint))},F=()=>Object.values(d).filter(v=>v===!0).length,M=p([{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"15m",value:"15m"},{label:"30m",value:"30m"},{label:"1h",value:"1h"},{label:"2h",value:"2h"},{label:"4h",value:"4h"},{label:"6h",value:"6h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"}]),A=p([]),t=p(null),o=p(null),b=p(null),V=p(null),m=O({symbol:c,temporality:e}),Y=p(!1),G=async()=>{a.chart.data=await a.searchClandlesSpot({symbol:m.symbol,temporality:m.temporality,cci:P.value})},ie=async()=>{const l=await a.searchSymbolsSpot();n.value=l.flatMap(s=>s.symbol.includes("USDT")?{label:s.symbol,value:s.symbol}:[]),await G()},q=async l=>{const s=M.value.find(v=>v.label==l.label);s!=null&&s.value?(m.temporality=s.value,a.chart.temporality=m.temporality):(m.symbol=l.value,a.chart.symbols=l.value),r.push({name:"spot:data",params:{symbol:String(m.symbol).toLowerCase(),temporality:a.chart.temporality}}),b.value=null,t.value&&(m!=null&&m.symbol)&&(m!=null&&m.temporality)&&(o.value&&await t.value.send(JSON.stringify({method:"UNSUBSCRIBE",params:[`${String(o.value).toLowerCase()}`],id:1})),o.value=`${String(m.symbol).toLowerCase()}@kline_${a.chart.temporality}`,t.value.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(o.value).toLowerCase()}`],id:1})),await G())};return window.addEventListener("resize",l=>{var v;const s=document.querySelector(".container-chart-main");(v=C==null?void 0:C.value)!=null&&v.resizeChart&&(s!=null&&s.offsetHeight)&&F()==0&&C.value.resizeChart({height:s.offsetHeight,width:s.offsetWidth,visualViewport:l.target.visualViewport})}),T(()=>"target.symbol",q),T(d,({rsi:l})=>{console.log("indicadores",{rsi:l})}),T(F,l=>{const s=document.querySelector(".container-chart-main").offsetWidth;if(l==0)C.value.resizeChart({height:document.querySelector(".container-chart-main").offsetHeight,width:s});else{const v=l==1?.7:l==2?.6:.5,h=l==1?.3:l==2?.2:.5/l,z=document.querySelector(".container-chart-main").offsetHeight-120*l;console.log({c:l,chartMainHeight:z,anchura:s,porcentajeChartMain:v,porcentajeChartIndicator:h}),C.value.resizeChart({height:z,width:s})}}),oe(async()=>{t.value=await new WebSocket("wss://stream.binance.com/ws"),o.value=`${String(m.symbol).toLowerCase()}@kline_1m`,await ie(),t.value.addEventListener("open",async function(l){t.value.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(o.value).toLowerCase()}`],id:1}))}),t.value.addEventListener("message",async function(l){var s,v;if(l&&l.data&&l.data!='{"result":null,"id":1}')try{const{k:{c:h,s:z,i:ze,h:K,l:Q,x:X,n:Oe,o:Z,T:ee,V:ae,v:Ne,t:re}}=JSON.parse(l.data);if(X===!0&&(a.chart.data.push({time:parseInt(ee),timeEnd:parseInt(re),open:parseFloat(Z),high:parseFloat(K),low:parseFloat(Q),close:parseFloat(h),value:parseFloat(h),volume:parseFloat(ae)}),console.log({x:X,chartcci:u},"* Cierre de vela",a.chart.data.length,new Date)),b.value=parseFloat(h).toFixed(4),V.value={time:parseInt(ee),open:parseFloat(Z),high:parseFloat(K),low:parseFloat(Q),close:parseFloat(h),value:parseFloat(h),volume:parseFloat(ae)},a.chart.data[a.chart.data.length-1]){a.chart.data[a.chart.data.length-1].high=V.value.high,a.chart.data[a.chart.data.length-1].low=V.value.low,a.chart.data[a.chart.data.length-1].close=V.value.close;let R=k.calcularCCI(a.chart.data,89);a.chart.data[a.chart.data.length-1].cci=parseFloat(parseFloat(R.pop()).toFixed(2))}if((s=y==null?void 0:y.value)!=null&&s.cci&&y.value.cci===!0){const R=a.chart.data[a.chart.data.length-1].cci>=100?"#00f5d4":a.chart.data[a.chart.data.length-1].cci<=-100?"#ff006e":null;R&&(V.value.color=R,V.value.borderColor=R,V.value.wickColor=R)}u&&(u!=null&&u.value)&&(u!=null&&u.value[0])&&((v=u.value[0])!=null&&v.refresh)&&u.value[0].refresh()}catch(h){console.log({evt:l,e:h})}})}),I({dataCandles:A,isRefresh:Y,target:m,SelectorV2:H,dataPairs:n,dataTemporality:M,AutoCompletedComponent:Me,chartStore:a,cantidadIndicadores:f,chartIndicators:d,activeIndicators:y,cantidadIndicadoresActivos:F,Ind:le}),(l,s)=>(_(),L("main",Re,[B("aside",null,[B("div",Te,[S(H,{opciones:n.value,onlyLabel:!1,displayAmount:!0,lblPorDefecto:g(a).chart.symbols,class:"spot-selector-symbols",onActionChange:q},null,8,["opciones","lblPorDefecto"]),S(H,{opciones:M.value,onlyLabel:!1,displayAmount:!1,lblPorDefecto:m.temporality,class:"spot-selector-temp",onActionChange:q},null,8,["opciones","lblPorDefecto"])]),b.value?(_(),L("label",Ee," PRICE: "+D(b.value),1)):E("",!0),B("pre",null,D(d),1),(_(!0),L(N,null,W(d,(v,h)=>(_(),L("button",{onClick:z=>d[h]=!d[h],class:"btn btn-ind"},D(h),9,Ue))),256)),B("pre",null,D(y.value)+" ["+D(F())+"]",1)]),Y.value?E("",!0):(_(),L("section",{key:0,class:j({"container-chart-main":!0,"ind-2":f.value==2})},[S(ke,{"chart-name-id":"chart-main",main:!0,ref_key:"chartMainSpot",ref:C,"data-candles":A.value,symbol:m.symbol,spot:!0,price:V.value,"chart-indicators":d,onCrosshairMove:U},null,8,["data-candles","symbol","price","chart-indicators"]),(_(!0),L(N,null,W(y.value,(v,h)=>(_(),J(le,{class:j(`indicador c-ind-${F()} ind-${h}`),ind:`${h}`,"data-candles":A.value,ref_for:!0,ref:`chart${h}`},null,8,["class","ind","data-candles"]))),256))],2))]))}};export{Ye as default};
