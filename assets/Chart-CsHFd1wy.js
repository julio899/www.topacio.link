import{_ as Ae}from"./Selector-BimVmnOd.js";import{V as Je}from"./lightweight-charts.production-Cq3om6Hu.js";import{u as Ue}from"./chart-Cjoe1J5-.js";import{_ as He,u as $e,r as o,o as ze,c8 as qe,p as Ke,h as Le,b as E,d as h,e as Ye,t as w,q as f,f as Ze,k as ee,i as Ge,cd as Qe,a as P}from"./index-D4y_j-vj.js";import{_ as Xe,a as ve,d as Se}from"./ActivadorIndicator-BEQjtVr-.js";const ea={class:"container-template-chart"},aa={key:0,class:"price"},ta={class:"target-symbols"},ia={class:"target-temporality"},sa={class:"btn-spot-futures"},la={class:"container-charts"},ra={__name:"Chart",setup(na,{expose:De}){const ae=$e(),b=new Ge;let m=null,l=null,v=null;const ye=o(null),p=o(null);let S,D,y,k,M,C,j,B,T,N,O,I,R,A,J,U,H,$,te="#cbf078",ie="#0092ca",se="#e84a5f",le="#a393eb",re="#defcf9",ne="#35bcbf",oe="#93deff";const c={bajista:[],alcista:[]},g={bajistas:[],alcistas:[]},e=Ue(),u=o(null),x=o(null),z=o(null),q=o([]),ce=o(null),V=o(0),_=o(!1),K=Qe();o(null),o(null);const ke=Se(()=>new Promise((a,t)=>{c.bajista.length>0&&c.bajista.forEach(s=>{let i=l.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});i.setData(s),g.bajistas.push(i)}),c.alcista.length>0&&c.alcista.forEach(s=>{let i=l.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});i.setData(s),g.alcistas.push(i)}),a(!0)}),500),fe=a=>{a.setData([])},Y=()=>new Promise((a,t)=>{c.alcista.length>0&&g.alcistas.forEach(fe),c.bajista.length>0&&g.bajistas.forEach(fe),c.alcista=[],c.bajista=[],console.log("resetDivergences: indicators.divergences",e.chart.indicators.divergences),a(!0)}),Me=async()=>{const a=x.value.offsetHeight,t=x.value.offsetWidth,s=b.getConfigChart(t,a),i=b.getConfigVelasTransparentes();l=Je(x.value,s),m=l.addCandlestickSeries(i),k=l.addLineSeries({color:"#f6483e33",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),M=l.addLineSeries({color:"#f0f8ff8f",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),C=l.addLineSeries({color:"#00ffa521",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),j=l.addLineSeries({color:"#84ff3d8a",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),B=l.addLineSeries({color:"orange",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),T=l.addLineSeries({color:"#f70776",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),N=l.addLineSeries({color:"#00bbf0",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),O=l.addLineSeries({color:"#bae8e8",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),I=l.addLineSeries({color:te,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),R=l.addLineSeries({color:ie,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),A=l.addLineSeries({color:se,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),J=l.addLineSeries({color:le,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),U=l.addLineSeries({color:re,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),H=l.addLineSeries({color:ne,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),$=l.addLineSeries({color:oe,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),S=l.addLineSeries({color:"yellow",lineWidth:4,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),D=l.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),y=l.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),z.value=l.addHistogramSeries({lastValueVisible:!1,priceLineVisible:!1,priceFormat:{type:"volume"},priceScaleId:"volumen"}),z.value.priceScale().applyOptions({priceFormat:{type:"volume"},scaleMargins:{top:.85,bottom:0}});const r=(await e.searchSymbols()).flatMap(d=>e.chart.symbols!=d.symbol?{label:d.symbol,value:d.symbol}:{label:d.symbol,value:d.symbol,selected:!0});q.value=r;const W=String(e.getSymbol).toLowerCase();v=await new WebSocket(`wss://fstream.binance.com/ws/${W}@kline_${e.getTemporality}`),v.addEventListener("open",d=>{console.log("* open",{event:d})}),v.addEventListener("message",Ce),he(),l.timeScale().subscribeVisibleLogicalRangeChange(xe),l.subscribeCrosshairMove(we),window.addEventListener("resize",ue)},Ce=async a=>{var t;if(a!=null&&a.data){const s=JSON.parse(a.data);if(!s||!((t=s==null?void 0:s.k)!=null&&t.c))return;const i=parseFloat(s.k.c);s.k.T&&parseInt(s.k.T),s.k.x&&s.k.x;const n=s.k.V?parseFloat(s.k.V):null;if(s.s==e.getSymbol&&e.getTemporality==s.k.i){const r={time:parseInt(s.k.T),open:parseFloat(s.k.o),high:parseFloat(s.k.h),low:parseFloat(s.k.l),close:i,value:i,volume:n};m.update(r),V.value=i}}},We=(a,t)=>t.time&&t.seriesData.get(a)||null,we=a=>{var s;const t=We(m,a);p!=null&&p.value&&((s=p==null?void 0:p.value)!=null&&s.syncCrosshair)&&t&&p.value.syncCrosshair(m,t)},xe=({from:a})=>{const t=l.timeScale().getVisibleLogicalRange(),s=l.timeScale().getVisibleRange(),i=parseInt(l.timeScale().scrollPosition());if(ye.value={visibleLogicalRange:t,visibleRange:s,scrollPosition:i,t:Date.now()},a&&a<100&&!_.value){console.log("*a buscar",_.value),_.value=!0;let n=e.chart.data[0].time;u.value.postMessage({command:"searchDataPrevius",data:{exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci,endTime:n,type:e.chart.futures?"futures":"spot"}})}},ue=()=>{},F=()=>{if(k.setData([]),C.setData([]),M.setData([]),!e.chart.indicators.bb)return;const a=e.chart.data.flatMap(i=>{let n={value:i.bb.upper,time:i.time};return i.high>i.bb.upper&&(n.color="#f443369e"),n}),t=e.chart.data.flatMap(i=>{let n={value:i.bb.lower,time:i.time};return i.low<i.bb.lower&&(n.color="#00ffa58a"),n}),s=e.chart.data.flatMap(i=>({value:i.bb.middle,time:i.time}));a.sort((i,n)=>i.time-n.time),t.sort((i,n)=>i.time-n.time),s.sort((i,n)=>i.time-n.time),k.setData(a),C.setData(t),M.setData(s)},_e=()=>{S.setData([]),D.setData([]),y.setData([]),Y(),F(),g.bajistas=[],g.alcistas=[],console.log("***",{leneasRenderDivergences:g}),de()};ze(()=>{u.value=new Worker(new URL("/assets/chartWorker-CYRRZhye.js",import.meta.url),{type:"module"}),Me(),u.value.onmessage=({data:{response:a,data:t,ema:s}})=>{if(a==="ema")return Ie({data:t,ema:s});if(a==="searchData"&&(e.chart.data=t,m.setData(t),_e(),X(),e.chart.indicators.divergences&&u.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))})),a==="responseProcessDivergence"&&t&&(console.log({response:a,data:t}),t.bajista?c.bajista=t.bajista:c.bajista=[],t.alcista?c.alcista=t.alcista:c.alcista=[],ke()),a==="searchDataPrevius"){const i=[].concat(t.toSpliced(-1),e.chart.data);return e.chart.data=i,m.setData(i),X(),new Promise((n,r)=>{F(),de(),e.chart.indicators.divergences&&u.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.kernelChannel?pe():(S.setData([]),D.setData([]),y.setData([])),Ve(),_.value=!1,n(!0)})}},ce.value=setInterval(je,1e3)}),qe(()=>{u.value.terminate(),clearInterval(ce.value),window.removeEventListener("resize")});const Fe=()=>{const t=`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`;v.send(JSON.stringify({method:"UNSUBSCRIBE",params:[t],id:new Date().getTime()}))},Ee=()=>{he(),v.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`],id:1}))},Z=async a=>{ge(),await Fe(),ae.loading=!0,V.value=null,console.log(e.getSymbol,"*",e.getTemporality),e.setSymbol(a.value),await Ee(),ae.loading=!1},Pe=a=>{const t=a.map(r=>r.value),s=t.reduce((r,W)=>r+W,0)/t.length;t.forEach(r=>{});const i=parseInt(s*2.5);return a.flatMap(r=>(r.value>=i&&(r.color="#96EFFF"),r))},je=()=>{new Date().toLocaleString()},de=()=>{const a=e.chart.data.flatMap(s=>({time:s.time,value:s.volume,color:"#d1e1e159"})),t=Pe(a);z.value.setData(t)},he=()=>{u.value.postMessage({command:"searchData",data:{exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci,type:e.chart.futures?"futures":"spot"}})},G=Ke(()=>V.value?V.value>.01?parseFloat(V.value).toFixed(4):parseFloat(V.value).toFixed(6):""),Be=K.params&&K.params.temporality?K.params.temporality.toString().toLocaleLowerCase():"4h",Te=[{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"30m",label:"30m"},{value:"1h",label:"1h"},{value:"2h",label:"2h"},{value:"4h",label:"4h"},{value:"1d",label:"1d"},{value:"3d",label:"3d"},{value:"1w",label:"1w"}],be=async a=>{e.chart.temporality=a.value,Z({value:String(e.getSymbol)})},me=o(Te.flatMap(a=>Be==a.label?{value:a.value,label:a.label,selected:!0}:{value:a.value,label:a.label})),Q=o("15m"),pe=()=>{const t=b.kernelChannel(e.chart.data,89,3.5),s=t.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.upperChannel).toFixed(4))})),i=t.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.lowerChannel).toFixed(4))})),n=t.flatMap((r,W)=>{const d=parseFloat(r.smoothedData)<e.chart.data[W].close?"#A6FF96":"#DA0C81";return{time:r.time,value:parseFloat(parseFloat(r.smoothedData).toFixed(4)),color:d}});S.setData(n),D.setData(s),y.setData(i)},Ne=Se(()=>{new Promise((a,t)=>(e.getcustomOption&&(u.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.kernelChannel&&pe(),e.chart.indicators.bb&&F()),a(!0))),console.log("checkCustomIndicators")},500);Le(e.getcustomOption,a=>{a?Ne():(S.setData([]),D.setData([]),y.setData([]),k.setData([]),C.setData([]),M.setData([]),Y(),console.log(e.getcustomOption,"clear")),console.log("*cambio",{status:a})});const ge=()=>{Y(),j.setData([]),B.setData([]),T.setData([]),N.setData([]),O.setData([]),k.setData([]),C.setData([]),M.setData([])},Ve=()=>{if(ge(),e.chart.indicators.divergences&&u.value.postMessage({command:"processDivergence",data:JSON.parse(JSON.stringify(e.chart.data))}),e.chart.indicators.bb&&F(),e.chart.indicators.hma10){const a=b.calculateHMA(e.chart.data,10);j.setData(a)}if(e.chart.indicators.hma20){const a=b.calculateHMA(e.chart.data,20,"#FF9D23");B.setData(a)}if(e.chart.indicators.hma55){const a=b.calculateHMA(e.chart.data,55,"#ff5733");T.setData(a)}if(e.chart.indicators.hma89){const a=b.calculateHMA(e.chart.data,89,"#9896f1");N.setData(a)}if(e.chart.indicators.hma233){const a=b.calculateHMA(e.chart.data,233,"#00bbf0");O.setData(a)}},Oe=a=>{l&&l.setCrosshairPosition(a,a.time,m)},Ie=({data:a,ema:t})=>{if(t===10)return I.setData(a);if(t===20)return R.setData(a);if(t===55)return A.setData(a);if(t===89)return J.setData(a);if(t===100)return U.setData(a);if(t===200)return H.setData(a);if(t===233)return $.setData(a)},L=(a,t="#fff")=>{u.value.postMessage({command:"calculateEma",data:JSON.parse(JSON.stringify(e.chart.data)),ema:a,color:t})},Re=()=>{e.chart.indicators.ema10||I.setData([]),e.chart.indicators.ema20||R.setData([]),e.chart.indicators.ema55||A.setData([]),e.chart.indicators.ema89||J.setData([]),e.chart.indicators.ema100||U.setData([]),e.chart.indicators.ema200||H.setData([]),e.chart.indicators.ema233||$.setData([])},X=()=>{Re(),e.chart.indicators.ema10&&L(10,te),e.chart.indicators.ema20&&L(20,ie),e.chart.indicators.ema55&&L(55,se),e.chart.indicators.ema89&&L(89,le),e.chart.indicators.ema100&&L(100,re),e.chart.indicators.ema200&&L(200,ne),e.chart.indicators.ema233&&L(233,oe)};return Le(e.chart.indicators,()=>{Ve(),X()}),De({chartStore:e,dataPairs:q,lastPrice:V,formatPrice:G,temporalityData:me,targetTemporality:Q,ChartMacd:Xe,ActivadorIndicator:ve,changeTemporality:be,changeTarget:Z,syncCrosshairMACD:Oe,resize:ue}),(a,t)=>{const s=Ae;return P(),E("div",ea,[h("h1",null,[Ye(w(f(e).getSymbol)+" "+w(f(e).getTemporality)+" ",1),G.value?(P(),E("span",aa,"price: "+w(G.value),1)):Ze("",!0)]),h("article",null,[h("div",ta,[ee(s,{opciones:q.value,onlyLabel:!1,lblPorDefecto:f(e).chart.symbols,onActionChange:Z},null,8,["opciones","lblPorDefecto"])]),h("div",ia,[ee(s,{lblPorDefecto:f(e).getTemporality,opciones:me.value,onlyLabel:!1,modelValue:Q.value,"onUpdate:modelValue":t[0]||(t[0]=i=>Q.value=i),onActionChange:be},null,8,["lblPorDefecto","opciones","modelValue"])]),h("p",sa,[f(e).chart.futures?(P(),E("span",{key:0,class:"btn-t bnt2",onClick:t[1]||(t[1]=(...i)=>f(e).toogleFutures&&f(e).toogleFutures(...i))},"FUTURES")):(P(),E("span",{key:1,class:"btn-t bnt2",onClick:t[2]||(t[2]=(...i)=>f(e).toogleFutures&&f(e).toogleFutures(...i))},"SPOT")),h("span",null,w(f(e).getExchange),1)]),h("pre",null,"        "+w(f(e).chart.indicators)+`
      `,1)]),h("div",la,[h("section",{id:"chart-principal",ref_key:"chartElement",ref:x},[ee(ve)],512)])])}}},ha=He(ra,[["__scopeId","data-v-a8e6b242"]]);export{ha as default};
