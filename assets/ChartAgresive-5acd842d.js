import{_ as oe,u as ce,r as D,z as re,l as x,f as xe,o as he,v as Fe,G as Ie,i as We,a as W,g as T,d as A,t as F,j as ne,e as Te,R as Ae,p as Be,b as He,h as de,D as Ee,E as je,C as I}from"./index-cb8913ad.js";import{u as fe,p as Ne,Y as Ue}from"./processDivergence-589d5061.js";const Oe=b=>(Be("data-v-79a8dfa2"),b=b(),He(),b),Re=["id"],$e={class:"legend"},Pe={key:0,class:"rsi"},ze={key:0,class:"timer-counter"},qe=Oe(()=>A("span",null,"Left time",-1)),Ke={__name:"Candles",props:["chartNameId","micro","main","t"],emits:["resizeChart"],setup(b,{expose:B,emit:u}){var se;const c=b,a=fe(),S=ce(),f=new de;let p=[];const y=D(!1),m=D(0),g=D(!1);let d,k,H=!1;const v=D(!1),K=D(null);let E,j,N,Y,U,O,G,Q,X,R,$,P;const L=re({bajista:[],alcista:[]}),Z=re({alcistas:[],bajistas:[]}),J=()=>{const i=new Ne(a.chart.data);return new Promise((s,o)=>{i.agregarCallback(e=>{L.alcista=e.alcista,L.bajista=e.bajista}),s(i.iniciarProceso())})},pe=()=>{let i=f.calculateEMA(a.chart.data,200,"#F2F7A1");Y.setData(i)};function w(){const i=new Date().getTime()+K.value*1e3-Date.parse(new Date),s=Math.floor(i/1e3%60),o=Math.floor(i/1e3/60%60),e=Math.floor(i/(1e3*60*60)%24),h=Math.floor(i/(1e3*60*60*24));return{total:i,days:h<10?"0"+h:h,hours:e<10?"0"+e:e,minutes:o<10?"0"+o:o,seconds:s<10?"0"+s:s}}const me=x(()=>w().seconds),ue=x(()=>w().minutes),be=x(()=>w().hours);x(()=>w().days);const ge=()=>{const i=document.querySelector(`#${c.chartNameId}`),s=parseInt(i.offsetWidth/1.01),o=parseInt(i.offsetHeight/1.01);let e=f.getConfigChart(s,o);const h=f.getConfigVelasTransparentes();d=Ue(i,e),k=d.addCandlestickSeries(h);const r=new Date().toLocaleString();c.main&&c.main===!0&&d.applyOptions({watermark:{color:"#00ff11",visible:!0,text:`Topacio ${String(a.getSymbol).toUpperCase()}  ${a.getTemporality}  ${r}`,fontSize:14,horzAlign:"left",vertAlign:"top"}}),c.micro&&c.micro===!0&&c.t&&d.applyOptions({watermark:{color:"#00ff11",visible:!0,text:`Topacio ${String(a.getSymbol).toUpperCase()}  ${c.t} Seg.`,fontSize:14,horzAlign:"left",vertAlign:"top"}}),E=d.addLineSeries({color:"#f6483e33",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),j=d.addLineSeries({color:"#f0f8ff8f",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),N=d.addLineSeries({color:"#00ffa521",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Y=d.addLineSeries({color:"yellow",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:3}),U=d.addLineSeries({color:"#84ff3d8a",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),O=d.addLineSeries({color:"orange",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),G=d.addLineSeries({color:"#f70776",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Q=d.addLineSeries({color:"#00bbf0",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),X=d.addLineSeries({color:"#bae8e8",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),d.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),R=d.addLineSeries({color:"yellow",lineWidth:4,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),$=d.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),P=d.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1})},ee=async i=>(K.value=parseInt((i.time-new Date().getTime())/1e3),new Promise(async(s,o)=>{i==null&&(console.log("#",i),o("undefined lastCandle"));const e=c.micro===!0&&c.t,h=e?p:a.chart.data;let r=JSON.parse(JSON.stringify(h));if(!(r.length<=15)){if(r[r.length-1].close=i.close,r[r.length-1].high=i.high,r[r.length-1].low=i.low,!e){const t=r.flatMap(l=>l.close),n=await f.calculoRSI(t);v.value=parseFloat(n[n.length-1]).toFixed(2)}s(v.value)}})),ve=async(i=!0)=>{g.value=i;const s=a.chart.data.flatMap(n=>n.close),o=await f.calculoRSI(s);let e=f.calcularMACD(s);const h=await f.calculateBollingerBands(s,89,3),r=f.calculateHMA(a.chart.data,10).flatMap(n=>n.value),t=f.calculateHMA(a.chart.data,20).flatMap(n=>n.value);a.chart.data[a.chart.data.length-1].bb||console.log("** noposee BB ",a.chart.data[a.chart.data.length-1],{isMicro:c.micro}),a.chart.data[a.chart.data.length-1].bb=h.pop(),a.chart.data[a.chart.data.length-1].rsi=o.pop(),a.chart.data[a.chart.data.length-1].macd=e.pop(),a.chart.data[a.chart.data.length-1].hma10=r.pop(),a.chart.data[a.chart.data.length-1].hma20=t.pop(),v.value=a.chart.data[a.chart.data.length-1].rsi},Le=()=>{if(E.setData([]),N.setData([]),j.setData([]),!a.chart.indicators.bb)return;const i=a.chart.data.flatMap(n=>{let l={value:n.bb.upper,time:n.time};return n.high>n.bb.upper&&(l.color="#f443369e"),l}),s=a.chart.data.flatMap(n=>{let l={value:n.bb.lower,time:n.time};return n.low<n.bb.lower&&(l.color="#00ffa58a"),l}),o=a.chart.data.flatMap(n=>({value:n.bb.middle,time:n.time}));function e(n,l){return n.time<l.time?-1:n.time>l.time?1:0}const h=i.sort(e),r=s.sort(e),t=o.sort(e);E.setData(h),N.setData(r),j.setData(t)},Ve=()=>{if(c.micro&&p.length>=20){const i=p.sort((e,h)=>e.time<h.time?-1:e.time>h.time?1:0);console.log("renderHmaMicro",{dataCandlesMicro:p,dtOrdernada:i});const s=f.calculateHMA(i,10);U.setData(s);const o=f.calculateHMA(i,20,"#f70776");O.setData(o)}},Se=()=>{if(!c.micro){if(a.chart.data=a.chart.data.sort((i,s)=>i.time<s.time?-1:i.time>s.time?1:0),a.chart.indicators.hma10){const i=a.chart.data.flatMap(s=>({value:s.hma10,time:s.time}));U.setData(i)}if(a.chart.indicators.hma20){const i=a.chart.data.flatMap(s=>({value:s.hma20,time:s.time}));O.setData(i)}if(a.chart.indicators.hma55){const i=f.calculateHMA(a.chart.data,55,"#f70776");G.setData(i)}if(a.chart.indicators.hma89){const i=f.calculateHMA(a.chart.data,89,"#9896f1");Q.setData(i)}if(a.chart.indicators.hma233){const i=f.calculateHMA(a.chart.data,233,"#00bbf0");X.setData(i)}}},ye=async()=>{const i=String(a.getSymbol).toLowerCase(),s=a.getTemporality,o=await new WebSocket(`wss://fstream.binance.com/ws/${i}@kline_${s}`);let e,h=0;o.addEventListener("message",async function(r){var n;if(S.loading)return;const t=JSON.parse(r.data);if(r&&(t!=null&&t.s)&&t.result==null&&(t!=null&&t.k)&&(t==null?void 0:t.k)!=null&&((n=t==null?void 0:t.k)==null?void 0:n.i)==a.getTemporality&&String(t.s).toUpperCase()==String(a.getSymbol).toUpperCase()){const l=parseFloat(t.k.c);t.k.T&&parseInt(t.k.T);const ke=t.k.x?t.k.x:!1,V=t.k.V?parseFloat(t.k.V):null,{micro:C,t:M}=c;if(C||(e={time:parseInt(t.k.T),open:parseFloat(t.k.o),high:parseFloat(t.k.h),low:parseFloat(t.k.l),close:l,value:l,volume:V},e.close=l,e.value=l,e.volume=V,e.high&&l>e.high&&(e.high=l),e&&e.low&&l<e.low&&(e.low=l),c.micro&&c.t?e.time=parseInt(m.value):e.time=parseInt(t.k.T),e&&e.close&&ee(e)),!y.value&&C&&M&&(m.value=t.E+M*1e3,e={time:m.value,open:parseFloat(l),high:parseFloat(l),low:parseFloat(l),close:l,value:l,volume:V},y.value=!0),ke&&!C){const le=a.chart.data[a.chart.data.length-1].time-a.chart.data[a.chart.data.length-2].time;e.time=parseInt(t.k.T)+le,e.open=parseFloat(t.k.o),e.high=parseFloat(t.k.h),e.low=parseFloat(t.k.l),e.close=parseFloat(l),e.volume=V,a.chart.data.push(e),g.value=!0,ae()}C&&M&&y.value&&(H&&(e.open=parseFloat(l),e.high=parseFloat(l),e.low=parseFloat(l),e.close=l,e.value=l,e.volume=V,H=!1),e.time=m.value,e.close=l,e.value=l,e.volume=V,l>e.high&&(e.high=l),l<e.low&&(e.low=l),t.E>m.value&&(g.value=!0,H=!0,m.value=t.E+M*1e3,e.time=parseInt(m.value),p.push(JSON.parse(JSON.stringify(e))),p=p.sort((z,q)=>q.time-z.time).filter((z,q,we)=>q===we.findIndex(Ce=>Ce.time===z.time)),console.log("close micro",p.length,M,m.value,p),Me()),e&&e.close&&ee(e)),t.E>h&&k.update(e)}h=t.E})},Me=async()=>{Ve(),De(),_e()},De=()=>{if(p.length>=5){const s=p.sort((r,t)=>t.high-r.high),o=p.flatMap(r=>r.close),e=Ae.calculate({values:o,period:10}),h=p.slice(5*-1);console.log("calcularDivergenciaMicro",{dtOrdernadaPriceHigh:s,highLast30Candles:h,closeMicro:o,rsi:e})}},ae=async()=>{c.micro||(await ve(),Le(),Se(),te(),pe())},_e=()=>{if(p.length<=5)return;const i=p.sort((t,n)=>t.time-n.time),s=i.length<89?i.length:80,o=f.kernelChannel(i,s,2.5),e=o.flatMap(t=>({time:t.time,value:parseFloat(parseFloat(t.upperChannel).toFixed(4))})),h=o.flatMap(t=>({time:t.time,value:parseFloat(parseFloat(t.lowerChannel).toFixed(4))})),r=o.flatMap(t=>({time:t.time,value:parseFloat(parseFloat(t.smoothedData).toFixed(4))}));R.setData(r),$.setData(e),P.setData(h),console.log({channelData:o,dtOrdernadaPriceHigh:i})},te=()=>{const s=f.kernelChannel(a.chart.data,89,2.5),o=s.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.upperChannel).toFixed(4))})),e=s.flatMap(r=>({time:r.time,value:parseFloat(parseFloat(r.lowerChannel).toFixed(4))})),h=s.flatMap((r,t)=>{const n=parseFloat(r.smoothedData)<a.chart.data[t].close?"#A6FF96":"#DA0C81";return{time:r.time,value:parseFloat(parseFloat(r.smoothedData).toFixed(4)),color:n}});R.setData(h),$.setData(o),P.setData(e)},ie=()=>{setTimeout(function(){new Promise((i,s)=>{L.bajista.length>0&&L.bajista.forEach(o=>{let e=d.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});e.setData(o),Z.bajistas.push(e)}),L.alcista.length>0&&L.alcista.forEach(o=>{let e=d.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});e.setData(o),Z.alcistas.push(e)}),i(!0)})},0)};return(se=a==null?void 0:a.getIndicators)!=null&&se.divergences&&c.main&&c.main===!0&&setTimeout(function(){Promise.resolve(J()).then(ie())},0),xe(()=>a.chart.data,function(i){c.main&&c.main===!0&&(ae(),k.setData(a.chart.data),te(),J().then(ie()))}),he(async()=>{await ge(),ye()}),B({chartStore:a,mainStore:S,chartNameId:c.chartNameId,lastRSI:v}),(i,s)=>Fe((W(),T("div",{id:b.chartNameId,ref:"chartElement",class:"charts-graphy"},[A("div",$e,[v.value?(W(),T("label",Pe,"RSI:"+F(v.value),1)):ne("",!0)]),c.micro?ne("",!0):(W(),T("div",ze,[qe,Te(" "+F(be.value)+":"+F(ue.value)+":"+F(me.value),1)]))],8,Re)),[[Ie,!We(S).loading]])}},_=oe(Ke,[["__scopeId","data-v-79a8dfa2"]]);const Ye={class:"charts"},Ge={class:"MainChart"},Qe={class:"microSection"},Xe={__name:"ChartAgresive",setup(b,{expose:B}){var m,g;const u=fe(),c=ce(),a=Ee();je();const S=new de,f=a.params&&a.params&&a.params.symbol?a.params.symbol.toString().toUpperCase():"BTCUSDT",p=a.params&&a.params&&a.params.temporality?a.params.temporality.toString().toLocaleLowerCase():"4h";(m=a==null?void 0:a.params)!=null&&m.symbol?u.chart.symbols=String(a.params.symbol).toUpperCase():u.chart.symbols=f,(g=a==null?void 0:a.params)!=null&&g.temporality?u.chart.temporality=a.params.temporality:u.chart.temporality=p;const y=async()=>{u.chart.data=await S.searchData({exchange:u.getExchange,interval:u.getTemporality,symbolsPairs:u.getSymbol,limit:500})};return he(async()=>{c.loading=!0,await y(),c.loading=!1}),B({Candles:_}),(d,k)=>(W(),T("main",Ye,[A("div",Ge,[I(_,{"chart-name-id":"chart-main",main:!0})]),A("div",Qe,[I(_,{"chart-name-id":"chart-5s",micro:!0,t:5}),I(_,{"chart-name-id":"chart-15s",micro:!0,t:15}),I(_,{"chart-name-id":"chart-30s",micro:!0,t:30})])]))}},aa=oe(Xe,[["__scopeId","data-v-515551f0"]]);export{aa as default};
