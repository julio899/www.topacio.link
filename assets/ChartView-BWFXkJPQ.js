import{r as C,o as ha,cc as Ya,a as M,b as R,d as m,F as Xa,i as Fa,_ as Wa,cd as Ka,ce as Ga,u as Qa,cf as Me,p as ke,h as p,q as w,e as me,t as E,k as ra,c9 as Za,cg as Ja,f as T,c as ca,s as et}from"./index-D6cdOfQ0.js";import{V as Aa}from"./lightweight-charts.production-Cq3om6Hu.js";import{u as da}from"./chart-BsVY0s-g.js";import{p as at}from"./processDivergence-CKT4E2ef.js";import{d as Ca,_ as xa,a as tt}from"./ActivadorIndicator-2NB1TIF4.js";import{_ as na}from"./Selector-BklrGGEr.js";const _a={__name:"ChartRsi",setup(ua,{expose:Z}){const J=new Fa,j=da();let g=[];const O=C(null);let $;return ha(()=>{g=j.chart.data.flatMap(B=>{let _={value:B.rsi,time:B.time};return B.rsi>75&&(_.color="#f70776"),B.rsi<25&&(_.color="#e0ffcd"),_});const e=document.querySelector("#chart-rsi");let s=J.getConfigChart(e.offsetWidth,e.offsetHeight);s.priceLineVisible=!1,s.priceLineColor="transparent",s.lastValueVisible=!1,s.localization={priceFormatter:B=>parseFloat(B).toFixed(2),timeFormatter:B=>Ya(new Date(B)).format("DD-MM-YYYY HH:mm:ss")},O.value=Aa(e,s),$=O.value.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:1,priceLineVisible:!1}),$.setData(g),console.log("dataRsi l:",g.length)}),Z({chart:O,updateAndRecalculate:()=>{g=j.chart.data.flatMap(e=>{if(!e.rsi)return[];let s={value:e.rsi,time:e.time};return e.rsi>75&&(s.color="#f70776"),e.rsi<25&&(s.color="#e0ffcd"),s}),$.setData(g)},update:e=>{$.update(e),O.value.applyOptions({watermark:{color:"rgba(255, 255, 255, 1)",visible:!0,text:`RSI 14 SMA ${e.value}`,fontSize:11,horzAlign:"left",vertAlign:"top"}})}}),(e,s)=>(M(),R(Xa,null,[s[0]||(s[0]=m("div",{id:"chart-rsi"},[m("div",{class:"vertical-cursor"})],-1)),s[1]||(s[1]=m("div",{id:"chart-macd"},null,-1))],64))}},lt={class:"target-selector"},it={class:"panelTarget"},st={class:"selectors-areas"},rt={class:"target-symbols"},nt={class:"target-temporality"},ot={class:"legend"},ct={class:"l-hma10"},ht={key:0,id:"hma10-label"},dt={class:"l-hma20"},ut={key:0,id:"hma20-label"},ft={class:"l-ema200"},mt={key:0,id:"ema200-label"},pt={class:"details"},bt={key:0,class:"d-price"},gt={key:1,class:"d-high"},Vt={key:2,class:"d-low"},Lt={key:3,class:"d-close"},vt={key:4,class:"d-rsi"},yt={key:5,class:"d-move"},St={key:6,class:"d-ps"},Dt={class:"timer-counter"},oa="#chart-main",Mt={__name:"ChartMobile",emits:["refresh"],setup(ua,{expose:Z,emit:J}){var ka,wa;const j=J,g=Ka(),O=Ga(),$=g.params&&g.params&&g.params.symbol?g.params.symbol.toString().toUpperCase():"BTCUSDT",z=g.params&&g.params&&g.params.temporality?g.params.temporality.toString().toLocaleLowerCase():"4h",x=Qa(),e=da(),s=new Fa,B=C(null),_=C(null),L=C(null),U=C(null),we=C(!1),Ce=C(!1),fa=C(null);let n,k;const N=C(0),ee=C(0),ma=C("15m");let xe,_e,Fe,pe,be,ge,Ve,We,Ae,Ie,Ee,Re,ae,te,le,ie,se,Le,Y,re,ne,oe,ce,he,ve,X,Te="#e0ffcd",Pe="#f96d00",Be="#ff347f",He="#a393eb",je="#35bcbf",Oe="#8ed6ff",$e="#b6cdbd",Ne="#cbf078",qe="#0092ca",ze="#e84a5f",Ue="#a393eb",Ye="#defcf9",Xe="#35bcbf",Ke="#93deff",Ge,de;const Qe=C(null),q=Me({bajista:[],alcista:[]}),P=Me({resistencia:null,soporte:null});let K=[],ue=[],ye=0,Ze=null;const G=Me({alcistas:[],bajistas:[]}),o=Me({price:null,close:null,high:null,low:null,rsi:null,rsih:null,higl:null,ps:null}),Ia=C([{value:"1m",label:"1m"},{value:"5m",label:"5m"},{value:"15m",label:"15m"},{value:"30m",label:"30m"},{value:"1h",label:"1h"},{value:"2h",label:"2h"},{value:"4h",label:"4h"},{value:"1d",label:"1d"},{value:"3d",label:"3d"},{value:"1w",label:"1w"}].flatMap(i=>z==i.label?{value:i.value,label:i.label,selected:!0}:{value:i.value,label:i.label}));(ka=g==null?void 0:g.params)!=null&&ka.symbol?e.chart.symbols=String(g.params.symbol).toUpperCase():e.chart.symbols=$,(wa=g==null?void 0:g.params)!=null&&wa.temporality?e.chart.temporality=g.params.temporality:e.chart.temporality=z;const Je=C([]),ea=C(!1);function Se(){const i=new Date().getTime()+Qe.value*1e3-Date.parse(new Date),a=Math.floor(i/1e3%60),l=Math.floor(i/1e3/60%60),r=Math.floor(i/(1e3*60*60)%24),c=Math.floor(i/(1e3*60*60*24));return{total:i,days:c<10?"0"+c:c,hours:r<10?"0"+r:r,minutes:l<10?"0"+l:l,seconds:a<10?"0"+a:a}}const pa=ke(()=>Se().seconds),ba=ke(()=>Se().minutes),Ea=ke(()=>Se().hours),Ra=ke(()=>Se().days),De=()=>{var l;const i=document.querySelector(oa);i!=null&&i.offsetHeight&&(n!=null&&n.resize)&&n.resize(parseInt(x.w/1.008),parseInt(i.offsetHeight));const a=document.querySelector("div#chart-rsi>div.vertical-cursor");(l=_==null?void 0:_.value)!=null&&l.chart&&a&&_.value.chart.resize(parseInt(document.querySelector("div.tv-lightweight-charts").offsetWidth),parseInt(document.querySelector("div#chart-rsi>div.vertical-cursor").offsetHeight))},ga=()=>{const a=s.kernelChannel(e.chart.data,89,3.5),l=a.flatMap(d=>({time:d.time,value:parseFloat(parseFloat(d.upperChannel).toFixed(4))})),r=a.flatMap(d=>({time:d.time,value:parseFloat(parseFloat(d.lowerChannel).toFixed(4))})),c=a.flatMap((d,y)=>{const V=parseFloat(d.smoothedData)<e.chart.data[y].close?"#A6FF96":"#DA0C81";return{time:d.time,value:parseFloat(parseFloat(d.smoothedData).toFixed(4)),color:V}});xe.setData(c),_e.setData(l),Fe.setData(r)};p(()=>x.w,function(i){De()}),p(()=>x.h,function(i){De()}),p(()=>e.chart.futures,async function(){const a=(await e.searchSymbols()).flatMap(l=>e.chart.symbols!=l.symbol?{label:l.symbol,value:l.symbol}:{label:l.symbol,value:l.symbol,selected:!0});Je.value=a,aa({value:e.chart.symbols})});const Ta=Ca(function(i){Ce.value=!0;let a=e.chart.data[0].time;s.searchData({exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci,endTime:a,type:e.chart.futures?"futures":"spot"}).then(l=>{l.pop(),console.log({previusData:l});const r=[...l,...e.chart.data];r.sort((c,d)=>parseInt(c.time)-parseInt(d.time)),e.chart.data=r,k.setData(r),i(),e.chart.indicators.macd&&L.value.processData(),_.value&&_.value.updateAndRecalculate()}).finally(function(){Ce.value=!1})},1e3),Pa=()=>{var i;if((i=e==null?void 0:e.chart)!=null&&i.data&&e.chart.data.length>100){const a=e.chart.data.flatMap(l=>l.close);s.calculoRSI(a.slice(-100)).then(l=>{var r;ee.value=l.pop(),_.value&&((r=e==null?void 0:e.chart)!=null&&r.data)&&e.chart.data.length>0&&e.chart.data[e.chart.data.length-1]&&(e.chart.data[e.chart.data.length-1].rsi=ee,e.chart.indicators.rsi&&e.chart.data&&e.chart.data.length>0&&_.value.update({value:ee,time:e.chart.data[e.chart.data.length-1].time}))})}},Ba=Ca(async()=>{const i=String(e.getSymbol).toLowerCase();U.value=await new WebSocket(`wss://fstream.binance.com/ws/${i}@kline_${e.getTemporality}`),U.value.addEventListener("message",async function(a){var r,c,d,y;if(ea.value&&ea.value==!0||x.loading)return;const l=JSON.parse(a.data);if(a&&(l!=null&&l.s)&&l.result==null&&(l!=null&&l.k)&&(l==null?void 0:l.k)!=null&&((r=l==null?void 0:l.k)==null?void 0:r.i)==e.getTemporality&&e.chart.data.length&&String(l.s).toUpperCase()==String(e.getSymbol).toUpperCase()){const V=parseFloat(l.k.c),v=l.k.T?parseInt(l.k.T):null,F=l.k.x?l.k.x:!1,b=l.k.V?parseFloat(l.k.V):null;de&&de.update({value:b,time:v,color:"#d1e1e159"}),N.value=V,o.price=V>100?parseFloat(V).toFixed(2):V;const u={time:parseInt(l.k.T),open:parseFloat(l.k.o),high:parseFloat(l.k.h),low:parseFloat(l.k.l),close:V,value:V,volume:b};if(e.chart.data[e.chart.data.length-1].time=u.time,e.chart.data[e.chart.data.length-1].open=u.open,e.chart.data[e.chart.data.length-1].high=u.high,e.chart.data[e.chart.data.length-1].low=u.low,e.chart.data[e.chart.data.length-1].close=u.close,e.chart.data[e.chart.data.length-1].value=u.value,e.chart.data[e.chart.data.length-1].volume=u.volume,Pa(),F&&((c=e==null?void 0:e.chart)!=null&&c.data)&&(await ja(),console.log("xClosed")),!we.value&&((d=e==null?void 0:e.chart)!=null&&d.data)&&e.chart.data.length>2&&e.chart.data[e.chart.data.length-1].high)if(e.chart.data[e.chart.data.length-1].high=u.high,e.chart.data[e.chart.data.length-1].low=u.low,e.chart.data[e.chart.data.length-1].close=u.close,e.chart.data[e.chart.data.length-1].volume=u.volume,e.chart.data[e.chart.data.length-1].value=u.value,(y=e==null?void 0:e.getIndicators)!=null&&y.heikinAshi){let fe=s.calculoNextHeikinAskiCandle(e.chart.data,e.chart.data[e.chart.data.length-1]);fe.time=u.time,k.update(fe)}else k.update(u);Qe.value=parseInt((u.time-new Date().getTime())/1e3)}else if(l.s&&String(l.s).toUpperCase()!=String(e.getSymbol).toUpperCase()){const v=`${String(l.s).toLowerCase()}@kline_${e.getTemporality}`;U.value.send(JSON.stringify({method:"UNSUBSCRIBE",params:[v],id:new Date().getTime()})),console.log("* UNSUBSCRIBE",{dtJson:l,evt:a,previusSocket:v,s:e.getSymbol},e.getSymbol,a.currentTarget,l.s===e.getSymbol),U.value.send(JSON.stringify({method:"LIST_SUBSCRIPTIONS",id:new Date().getTime()}))}}),console.log("openSocket")}),Ha=async i=>{e.chart.temporality=i.value,aa({value:String(e.getSymbol)})},aa=i=>{x.loading=!0,ea.value=!0,Ze=i.value;const l=`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`;if(e.chart.symbols=String(Ze).toUpperCase(),O.push({name:"alpha:data",params:{symbol:String(Ze).toLowerCase(),temporality:e.chart.temporality}}),U.value)return U.value.send(JSON.stringify({method:"UNSUBSCRIBE",params:[l],id:1})),U.value.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(e.getSymbol).toLowerCase()}@kline_${e.getTemporality}`],id:1})),j("refresh")},ja=async(i=!0)=>{we.value=i,s.recalculeIndicators(e.chart.data).then(a=>{var c;e.chart.data[e.chart.data.length-1]=a.last;const l=e.chart.data[e.chart.data.length-1].time-e.chart.data[e.chart.data.length-2].time;console.log({dataUpdate:a});const r={open:a.last.close,close:a.last.close,high:a.last.close,low:a.last.close,time:a.last.time+l,macd:a.last.macd,volume:(c=a==null?void 0:a.last)!=null&&c.volume?a.last.volume:0,bb:{middle:a.last.bb.middle,upper:a.last.bb.upper,lower:a.last.bb.lower,pb:a.last.bb.pb},rsi:a.last.bb.rsi,hma10:a.last.hma10,hma20:a.last.hma20,value:a.last.value};e.chart.data.push(r),ta(),we.value=!1}),e.chart.indicators.macd&&L.value&&L.value.processData()},Oa=()=>{n&&(pe=n.addLineSeries({color:"#f6483e33",lineWidth:2,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),be=n.addLineSeries({color:"#f6483e33",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),ge=n.addLineSeries({color:"#f0f8ff8f",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),Ve=n.addLineSeries({color:"#00ffa521",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Ge=n.addLineSeries({color:"yellow",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:3}),n.addLineSeries({color:"yellow",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),We=n.addLineSeries({color:"#84ff3d8a",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Ae=n.addLineSeries({color:"orange",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Ie=n.addLineSeries({color:"#f70776",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Ee=n.addLineSeries({color:"#00bbf0",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Re=n.addLineSeries({color:"#bae8e8",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),ae=n.addLineSeries({color:Ne,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),te=n.addLineSeries({color:qe,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),le=n.addLineSeries({color:ze,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),ie=n.addLineSeries({color:Ue,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),se=n.addLineSeries({color:Ye,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Le=n.addLineSeries({color:Xe,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Y=n.addLineSeries({color:Ke,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),re=n.addLineSeries({color:Te,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),ne=n.addLineSeries({color:Pe,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),oe=n.addLineSeries({color:Be,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),ce=n.addLineSeries({color:He,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),he=n.addLineSeries({color:je,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),ve=n.addLineSeries({color:Oe,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),X=n.addLineSeries({color:$e,lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),xe=n.addLineSeries({color:"yellow",lineWidth:4,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),_e=n.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),Fe=n.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}))},Va=()=>{const a=e.chart.data.flatMap(h=>h).sort((h,D)=>parseInt(D.time)-parseInt(h.time));let l=25,r=0,c=0,d=[],y=[],V=[],v=[];for(var F=0;F<a.length;F++)if(r++,r==l){const h=a.slice(parseInt(c*l),parseInt(c*l)+l),D=h.flatMap(I=>I),la=h.flatMap(I=>I),S=D.sort((I,sa)=>parseFloat(sa.high)-parseFloat(I.high)),ia=la.sort((I,sa)=>parseFloat(I.low)-parseFloat(sa.low));if(!S||!S[0])return;const A=S[0];if((y.length==0&&A||A!=null&&A.high&&y[y.length-1].high<A.high)&&y.push(A),d.length==0&&A?(d.push(A),v.push({linea:[A]})):A!=null&&A.high&&d[d.length-1].high>A.high&&d.push(A),ia&&ia[0]){const I=ia[0];(V.length==0&&I||I!=null&&I.low&&V[V.length-1].low>I.low)&&V.push(I)}r=0,c++}console.log({highDescend:y,highAccend:d,lowDescend:V,marcaciones_leneas_asc:v});const u=e.chart.data.slice(-89).sort((h,D)=>D.high===h.high?parseInt(D.time)-parseInt(h.time):parseFloat(h.high)-parseFloat(D.high));u.sort((h,D)=>parseInt(h.time)-parseInt(D.time)),u.flatMap(h=>h).sort((h,D)=>parseFloat(D.high)-parseFloat(h.high));let t=null;for(var F=u.length-1;F>=0;F--)t?u[F].high>t.high&&(t=u[F]):t=u[F];d.flatMap(h=>({time:h.time,value:h.high,color:"#EC8F5E"})),n.addLineSeries({color:"#EC8F5E",lineWidth:3,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:1});const f=y.flatMap(h=>({time:h.time,value:h.high,color:"olive"}));P.resistencia&&n&&P.resistencia.setData([]),P.soporte&&n&&P.soporte.setData([]),P.resistencia=n.addLineSeries({color:"olive",lineWidth:3,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:1}),P.soporte=n.addLineSeries({color:"#fff",lineWidth:3,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:1});const W=f.flatMap(h=>h);W.sort((h,D)=>parseInt(h.time)-parseInt(D.time)),P.resistencia.setData(W);const H=V.flatMap(h=>({time:h.time,value:h.low,color:"#fff"}));P.soporte.setData(H.sort((h,D)=>parseInt(h.time)-parseInt(D.time))),console.log("lineaTendenciaAlcista::..")},La=()=>{if(be.setData([]),Ve.setData([]),ge.setData([]),!e.chart.indicators.bb)return;const i=e.chart.data.flatMap(r=>{let c={value:r.bb.upper,time:r.time};return r.high>r.bb.upper&&(c.color="#f443369e"),c}),a=e.chart.data.flatMap(r=>{let c={value:r.bb.lower,time:r.time};return r.low<r.bb.lower&&(c.color="#00ffa58a"),c}),l=e.chart.data.flatMap(r=>({value:r.bb.middle,time:r.time}));i.sort((r,c)=>r.time-c.time),a.sort((r,c)=>r.time-c.time),l.sort((r,c)=>r.time-c.time),be.setData(i),Ve.setData(a),ge.setData(l)},Q=()=>{if(e.chart.data=e.chart.data.sort((i,a)=>i.time<a.time?-1:i.time>a.time?1:0),e.chart.indicators.hma10){const i=e.chart.data.flatMap(a=>({value:a.hma10,time:a.time}));We.setData(i)}if(e.chart.indicators.hma20){const i=e.chart.data.flatMap(a=>({value:a.hma20,time:a.time}));Ae.setData(i)}if(e.chart.indicators.hma55){const i=s.calculateHMA(e.chart.data,55,"#f70776");Ie.setData(i)}if(e.chart.indicators.hma89){const i=s.calculateHMA(e.chart.data,89,"#9896f1");Ee.setData(i)}if(e.chart.indicators.hma233){const i=s.calculateHMA(e.chart.data,233,"#00bbf0");Re.setData(i)}},va=()=>{if(!e.chart.indicators.psar){pe.setData([]);return}const i=e.chart.data.flatMap(c=>c.high),a=e.chart.data.flatMap(c=>c.low),r=s.calculoPSAR(a,i).flatMap((c,d)=>({value:c,time:e.chart.data[d].time,color:e.chart.data[d].close>c?"aqua":"red"}));pe.setData(r)},$a=()=>{re.setData([]),ne.setData([]),oe.setData([]),ce.setData([]),he.setData([]),ve.setData([]),X.setData([]),e.chart.indicators.sma10&&re.setData(s.calculateEMA(e.chart.data,10,Te)),e.chart.indicators.sma20&&ne.setData(s.calculateEMA(e.chart.data,20,Pe)),e.chart.indicators.sma55&&oe.setData(s.calculateEMA(e.chart.data,55,Be)),e.chart.indicators.sma89&&ce.setData(s.calculateEMA(e.chart.data,89,He)),e.chart.indicators.sma100&&he.setData(s.calculateEMA(e.chart.data,100,je)),e.chart.indicators.sma200&&X.setData(s.calculateEMA(e.chart.data,200,Oe)),e.chart.indicators.sma233&&X.setData(s.calculateEMA(e.chart.data,233,$e))},Na=()=>{ae.setData([]),te.setData([]),le.setData([]),ie.setData([]),se.setData([]),Le.setData([]),Y.setData([]),e.chart.indicators.ema10&&ae.setData(s.calculateEMA(e.chart.data,10,Ne)),e.chart.indicators.ema20&&te.setData(s.calculateEMA(e.chart.data,20,qe)),e.chart.indicators.ema55&&le.setData(s.calculateEMA(e.chart.data,55,ze)),e.chart.indicators.ema89&&ie.setData(s.calculateEMA(e.chart.data,89,Ue)),e.chart.indicators.ema100&&se.setData(s.calculateEMA(e.chart.data,100,Ye)),e.chart.indicators.ema200&&Y.setData(s.calculateEMA(e.chart.data,200,Xe)),e.chart.indicators.ema233&&Y.setData(s.calculateEMA(e.chart.data,233,Ke))},ya=()=>{const i=new at(e.chart.data);return new Promise((a,l)=>{i.agregarCallback(r=>{q.alcista=r.alcista,q.bajista=r.bajista}),a(i.iniciarProceso())})},Sa=()=>{setTimeout(function(){new Promise((i,a)=>{q.bajista.length>0&&q.bajista.forEach(l=>{let r=n.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});r.setData(l),G.bajistas.push(r)}),q.alcista.length>0&&q.alcista.forEach(l=>{let r=n.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});r.setData(l),G.alcistas.push(r)}),i(!0)})},0)},Da=async()=>{const i=await s.calculoVelasHeikinAshi(e.chart.data);k.setData(i)},ta=()=>{var i,a;La(),Q(),Na(),$a(),va(),(i=e==null?void 0:e.getIndicators)!=null&&i.heikinAshi&&e.getIndicators.heikinAshi==!0&&Da(),(a=e==null?void 0:e.getIndicators)!=null&&a.divergences&&setTimeout(function(){Promise.resolve(ya()).then(Sa())},0),e.chart.indicators.kernelChannel&&ga(),e.chart.indicators.srDinamic&&Va(),Ua()},qa=()=>{const i=new Date().toLocaleString();N.value&&N.value&&N.value!=null&&N.value>0&&!isNaN(N.value)&&""+parseFloat(N.value).toFixed(4),n.applyOptions({watermark:{color:"#00ff11",visible:!0,text:`Topacio ${String(e.getSymbol).toUpperCase()}  ${e.getTemporality}  ${i}`,fontSize:14,horzAlign:"left",vertAlign:"top"}})},za=i=>{i.flatMap(b=>b).sort((b,u)=>b.value-u.value).slice(-7).flatMap(b=>b.time);const r=i.map(b=>b.value),c=r.reduce((b,u)=>b+u,0)/r.length,d={};r.forEach(b=>{d[b]=(d[b]||0)+1}),Object.keys(d).reduce((b,u)=>d[b]>d[u]?b:u);const y=r.slice().sort((b,u)=>b-u),V=Math.floor(y.length/2);y.length%2===0?(y[V-1]+y[V])/2:y[V];const v=parseInt(c*2.5);return i.flatMap(b=>(b.value>=v&&(b.color="#96EFFF"),b))},Ua=()=>{const i=e.chart.data.flatMap(l=>({time:l.time,value:l.volume,color:"#d1e1e159"})),a=za(i);de.setData(a)};ha(async()=>{x.loading=!0,x.openMenuMobile=!1;const i=document.querySelector(oa),a=parseInt(x.w/1.005),l=parseInt(i.offsetHeight),r=s.getConfigChart(a,l),c=s.getConfigVelasTransparentes();e.chart.data=await s.searchData({exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci});const d=document.querySelector(oa);console.log({configChart:r},e.chart.data),n=Aa(d,r),k=n.addCandlestickSeries(c),k.setData(e.chart.data),de=n.addHistogramSeries({lastValueVisible:!1,priceLineVisible:!1,priceFormat:{type:"volume"},priceScaleId:"volumen"}),de.priceScale().applyOptions({priceFormat:{type:"volume"},scaleMargins:{top:.85,bottom:0}});const V=(await e.searchSymbols()).flatMap(t=>e.chart.symbols!=t.symbol?{label:t.symbol,value:t.symbol}:{label:t.symbol,value:t.symbol,selected:!0});Je.value=V,Oa(),ta(),qa();let v=n.timeScale().getVisibleLogicalRange(),F=v&&(v!=null&&v.from)?parseInt(v.from):null;function b(t){var W,H,h,D;const f=document.querySelector("div#chart-rsi>div.vertical-cursor");if(t!=null&&t.time&&n){const la=n.timeScale().getVisibleLogicalRange(),S=parseInt(t.logical);(W=t==null?void 0:t.point)!=null&&W.x&&f&&(_.value.chart.timeScale().setVisibleLogicalRange(la),f.style=`transform:translateX(${t.point.x}px)`),e.chart.data[S]&&(o.rsi=e.chart.data[S].rsi,o.low=e.chart.data[S].low,o.high=e.chart.data[S].high,o.close=e.chart.data[S].close,o.move=s.calculatePercentageBetweenValues(o.high,o.low),o.ps=null,o.hma10=(H=e.chart.data[S])!=null&&H.hma10?parseFloat(e.chart.data[S].hma10).toFixed(4):null,o.hma20=(h=e.chart.data[S])!=null&&h.hma20?parseFloat(e.chart.data[S].hma20).toFixed(4):null,e.chart.data[S].bb&&o.high>e.chart.data[S].bb.upper&&(o.ps=s.calculatePercentageBetweenValues(o.high,e.chart.data[S].bb.upper)),e.chart.data[S].bb&&o.low<e.chart.data[S].bb.lower&&(o.ps=s.calculatePercentageBetweenValues(e.chart.data[S].bb.lower,o.low))),v=n.timeScale().getVisibleLogicalRange(),F=v!=null&&v.from?parseInt(v.from):null,F&&F<250&&!Ce.value&&Ta(ta)}else f&&(f.style="display:none"),o.rsi=null,o.ps=null,o.move=null,o.low=null,o.high=null,o.close=null,o.ema200=null,o.hma10=null,o.hma20=null;(D=t==null?void 0:t.point)!=null&&D.y&&(ye=k.coordinateToPrice(t.point.y))}n.subscribeCrosshairMove(b),document.addEventListener("keydown",t=>{if(K[t.key]=!0,K.Alt&&t.key=="h"){const f=k.createPriceLine({price:ye,color:"#FFF"});ue.push(f)}if(K.Alt&&t.key=="s"){const f=k.createPriceLine({price:ye,color:"#ff006e",title:"Short"});ue.push(f)}if(K.Alt&&t.key=="l"){const f=k.createPriceLine({price:ye,color:"#00ff11",title:"Long"});ue.push(f)}(K.Alt&&t.key=="r"||t.key=="c")&&(console.log("* Cleaning Lines"),ue.map(f=>k.removePriceLine(f)),ue=[])}),document.addEventListener("keyup",t=>{delete K[t.key]}),document.querySelector("div.container-chart").addEventListener("click",t=>{var f;if((f=window==null?void 0:window.visualViewport)!=null&&f.width){const W=window.visualViewport.width,H=parseInt(W)*.2;t.x>H&&e.chart.menuOpen===!0&&(e.chart.menuOpen=!1)}}),setTimeout(function(){De()},1e3),Ba(),x.loading=!1,p(()=>e.chart.indicators.srDinamic,t=>{!t&&P.resistencia&&P.soporte?(P.resistencia.setData([]),P.soporte.setData([])):Va()}),p(()=>e.chart.indicators.cci,async t=>{const f=await s.searchData({exchange:e.getExchange,interval:e.getTemporality,symbolsPairs:e.getSymbol,limit:500,cci:e.chart.indicators.cci});f.sort((W,H)=>parseInt(W.time)-parseInt(H.time)),e.chart.data=f,k.setData(f),console.log("newValue",t,{allData:f})}),p(()=>e.chart.indicators.psar,t=>{t?va():pe.setData([])}),p(()=>e.chart.indicators.kernelChannel,t=>{t?ga():(xe.setData([]),_e.setData([]),Fe.setData([]))}),p(()=>e.chart.indicators.bb,t=>{t?La():(be.setData([]),Ve.setData([]),ge.setData([]))}),p(()=>e.chart.indicators.hma10,t=>{t?Q():We.setData([])}),p(()=>e.chart.indicators.hma20,t=>{t?Q():Ae.setData([])}),p(()=>e.chart.indicators.hma55,t=>{t?Q():Ie.setData([])}),p(()=>e.chart.indicators.hma89,t=>{t?Q():Ee.setData([])}),p(()=>e.chart.indicators.hma233,t=>{t?Q():Re.setData([])}),p(()=>e.chart.indicators.heikinAshi,t=>{t?Da():k.setData(e.chart.data)}),p(()=>e.chart.indicators.ema10,t=>{t?ae.setData(s.calculateEMA(e.chart.data,10,Ne)):ae.setData([])}),p(()=>e.chart.indicators.ema20,t=>{t?te.setData(s.calculateEMA(e.chart.data,20,qe)):te.setData([])}),p(()=>e.chart.indicators.ema55,t=>{t?le.setData(s.calculateEMA(e.chart.data,55,ze)):le.setData([])}),p(()=>e.chart.indicators.ema89,t=>{t?ie.setData(s.calculateEMA(e.chart.data,89,Ue)):ie.setData([])}),p(()=>e.chart.indicators.ema100,t=>{t?se.setData(s.calculateEMA(e.chart.data,100,Ye)):se.setData([])}),p(()=>e.chart.indicators.ema200,t=>{t?(Ge.setData([]),Le.setData(s.calculateEMA(e.chart.data,200,Xe))):(Ge.setData([]),Le.setData([]))}),p(()=>e.chart.indicators.ema233,t=>{t?Y.setData(s.calculateEMA(e.chart.data,233,Ke)):Y.setData([])}),p(()=>e.chart.indicators.sma10,t=>{t?re.setData(s.calcularSMA(e.chart.data,10,Te)):re.setData([])}),p(()=>e.chart.indicators.sma20,t=>{t?ne.setData(s.calcularSMA(e.chart.data,20,Pe)):ne.setData([])}),p(()=>e.chart.indicators.sma55,t=>{t?oe.setData(s.calcularSMA(e.chart.data,55,Be)):oe.setData([])}),p(()=>e.chart.indicators.sma89,t=>{t?ce.setData(s.calcularSMA(e.chart.data,89,He)):ce.setData([])}),p(()=>e.chart.indicators.sma100,t=>{t?he.setData(s.calcularSMA(e.chart.data,100,je)):he.setData([])}),p(()=>e.chart.indicators.sma200,t=>{t?ve.setData(s.calcularSMA(e.chart.data,200,Oe)):ve.setData([])}),p(()=>e.chart.indicators.sma233,t=>{t?X.setData(s.calcularSMA(e.chart.data,233,$e)):X.setData([])}),p(()=>e.chart.indicators.divergences,t=>{t?Promise.resolve(ya()).then(Sa()):(G.alcistas.forEach(function(f){f.setData([])}),G.bajistas.forEach(function(f){f.setData([])}),G.alcistas=[],G.bajistas=[],q.alcista=[],q.bajista=[])});function u(t){var h;const f=n.timeScale().getVisibleLogicalRange(),W=n.timeScale().getVisibleRange(),H=parseInt(n.timeScale().scrollPosition());fa.value={visibleLogicalRange:f,visibleRange:W,scrollPosition:H,t:Date.now()},L!=null&&L.value&&((h=L==null?void 0:L.value)!=null&&h.timeScale)&&L.value.timeScale().setVisibleLogicalRange(t)}const fe=(t,f)=>f.time&&f.seriesData.get(t)||null;n.subscribeCrosshairMove(t=>{var W;const f=fe(k,t);L!=null&&L.value&&((W=L==null?void 0:L.value)!=null&&W.syncCrosshair)&&L.value.syncCrosshair(k,f)}),n.timeScale().subscribeVisibleLogicalRangeChange(u)});const Ma=i=>{n.setCrosshairPosition(i,i.time,k)};return Z({mainStore:x,chartStore:e,lastPrice:N,details:o,leftTime:Qe,getSegundsLeft:pa,getMinLeft:ba,getDaysLeft:Ra,Selector:na,ChartRsi:_a,ChartMacd:xa,chartMacd:L,lastRSI:ee,syncCrosshairMACD:Ma}),(i,a)=>(M(),R("div",{class:et({"container-chart":!0,"graphic-macd":w(e).chart.indicators.macd})},[m("div",lt,[m("div",it,[m("p",null,[w(e).chart.futures?(M(),R("span",{key:0,class:"btn-t bnt2",onClick:a[0]||(a[0]=(...l)=>w(e).toogleFutures&&w(e).toogleFutures(...l))},"FUTURES")):(M(),R("span",{key:1,class:"btn-t bnt2",onClick:a[1]||(a[1]=(...l)=>w(e).toogleFutures&&w(e).toogleFutures(...l))},"SPOT")),me(" : "+E(w(e).getExchange),1)]),m("div",st,[m("div",rt,[ra(na,{opciones:Je.value,onlyLabel:!1,lblPorDefecto:w(e).chart.symbols,onActionChange:aa},null,8,["opciones","lblPorDefecto"])]),m("div",nt,[ra(na,{lblPorDefecto:w(e).getTemporality,opciones:Ia.value,onlyLabel:!1,modelValue:ma.value,"onUpdate:modelValue":a[2]||(a[2]=l=>ma.value=l),onActionChange:Ha},null,8,["lblPorDefecto","opciones","modelValue"])])])])]),Za(m("div",{id:"chart-main",ref_key:"chartElement",ref:B},[m("div",ot,[m("span",ct,[a[3]||(a[3]=me("HMA10 ")),o.hma10?(M(),R("label",ht,E(o.hma10),1)):T("",!0)]),m("span",dt,[a[4]||(a[4]=me("HMA20 ")),o.hma10?(M(),R("label",ut,E(o.hma20),1)):T("",!0)]),m("span",ft,[a[5]||(a[5]=me("EMA200 --- ")),o.ema200?(M(),R("label",mt,E(o.ema200),1)):T("",!0)])]),m("div",pt,[o.price?(M(),R("span",bt,[a[6]||(a[6]=m("p",null,"Price:",-1)),m("b",null,E(o.price),1),m("b",null,"RSI "+E(ee.value),1)])):T("",!0),o.high?(M(),R("span",gt,[a[7]||(a[7]=m("p",null,"High:",-1)),m("p",null,E(o.high),1)])):T("",!0),o.low?(M(),R("span",Vt,[a[8]||(a[8]=m("p",null,"Low:",-1)),m("p",null,E(o.low),1)])):T("",!0),o.close?(M(),R("span",Lt,[a[9]||(a[9]=m("p",null,"Close:",-1)),m("p",null,E(o.close),1)])):T("",!0),o.rsi?(M(),R("span",vt,[a[10]||(a[10]=m("p",null,"RSI",-1)),m("p",null,E(o.rsi),1)])):T("",!0),o.move?(M(),R("span",yt,[a[11]||(a[11]=m("p",null,"move",-1)),m("p",null,E(o.move)+"%",1)])):T("",!0),o.ps?(M(),R("span",St,[a[12]||(a[12]=m("b",null,"PS ",-1)),m("p",null,E(o.ps)+"%",1)])):T("",!0)]),m("div",Dt,[a[13]||(a[13]=m("span",null,"Left time",-1)),me(" "+E(Ea.value)+":"+E(ba.value)+":"+E(pa.value),1)])],512),[[Ja,!w(x).loading]]),w(e).chart.data.length>0&&!w(x).loading&&w(e).chart.indicators.rsi?(M(),ca(_a,{key:0,ref_key:"chartRsi",ref:_},null,512)):T("",!0),!w(x).loading&&w(e).chart.data.length>0&&w(e).chart.indicators.macd?(M(),ca(xa,{key:1,chartInfoVisible:fa.value,onResizeChart:De,onSyncCrosshair:Ma,ref_key:"chartMacd",ref:L},null,8,["chartInfoVisible"])):T("",!0),ra(tt)],2))}},kt=Wa(Mt,[["__scopeId","data-v-0dd3e86f"]]),wt={class:"charts"},Ct={__name:"ChartView",setup(ua,{expose:Z}){const J=da(),j=C(!1),g=()=>{j.value=!0,console.log("reloadChart"),setTimeout(function(){j.value=!1},100)},O=new Worker(new URL("/assets/claculateForCharts-BdmvpLvX.js",import.meta.url)),$=async()=>{O.postMessage({name:"searchData",type:J.chart.futures?"futures":"spot"}),O.onmessage=z=>{z.data&&console.log({recibe:z.data})}};return ha(()=>{$()}),Z({isRefresh:j}),(z,x)=>(M(),R("main",wt,[j.value?T("",!0):(M(),ca(kt,{key:0,onRefresh:g}))]))}},Rt=Wa(Ct,[["__scopeId","data-v-c1e516f6"]]);export{Rt as default};
