import{p as We,C as $e,_ as Ne}from"./Selector-59a043d7.js";import{_ as de,u as ue,r as v,I as ce,k as Ue,A as J,f as Ee,o as me,v as Oe,J as je,l as G,a as U,g as E,d as C,t as K,m as he,e as He,R as Re,p as fe,b as pe,h as ge,G as Pe,H as ze,n as $}from"./index-5d9c99f0.js";import{u as be}from"./chart-5b28736d.js";const qe=y=>(fe("data-v-38efa76b"),y=y(),pe(),y),Je=["id"],Ke={class:"legend"},Ge={key:0,class:"rsi"},Qe={key:0,class:"timer-counter"},Xe=qe(()=>C("span",null,"Left time",-1)),Ye={__name:"Candles",props:["chartNameId","micro","main","t"],emits:["resizeChart"],setup(y,{expose:Q,emit:m}){var oe;const a=be(),d=ue(),f=new ge,c=y;let u=[];const w=v(!1),S=v(0),D=v(!1);let n,_,I=!1;const M=v(!1),B=v(null),V=v(null);let x,T,g,A,p,O,ae,X,Y,j,H,R;const L=ce({bajista:[],alcista:[]}),F=ce({alcistas:[],bajistas:[]});Ue(()=>{n&&n.remove()});const te=()=>{const s=new We(a.chart.data);return new Promise((l,e)=>{s.agregarCallback(r=>{L.alcista=r.alcista,L.bajista=r.bajista}),l(s.iniciarProceso())})},ye=()=>{let s=f.calculateEMA(a.chart.data,200,"#F2F7A1");A.setData(s)};function P(){const s=new Date().getTime()+B.value*1e3-Date.parse(new Date),l=Math.floor(s/1e3%60),e=Math.floor(s/1e3/60%60),r=Math.floor(s/(1e3*60*60)%24),o=Math.floor(s/(1e3*60*60*24));return{total:s,days:o<10?"0"+o:o,hours:r<10?"0"+r:r,minutes:e<10?"0"+e:e,seconds:l<10?"0"+l:l}}const Se=J(()=>P().seconds),Le=J(()=>P().minutes),_e=J(()=>P().hours);J(()=>P().days);const se=()=>{const s=document.querySelector(`#${c.chartNameId}`),l=parseInt(s.offsetWidth/1.01),e=parseInt(s.offsetHeight/1.01);let r=f.getConfigChart(l,e);const o=f.getConfigVelasTransparentes();n=$e(s,r),_=n.addCandlestickSeries(o);const t=new Date().toLocaleString();c.main&&c.main===!0&&n.applyOptions({watermark:{color:"#00ff11",visible:!0,text:`Topacio ${String(a.getSymbol).toUpperCase()}  ${a.getTemporality}  ${t}`,fontSize:14,horzAlign:"left",vertAlign:"top"}}),c.micro&&c.micro===!0&&c.t&&n.applyOptions({watermark:{color:"#00ff11",visible:!0,text:`Topacio ${String(a.getSymbol).toUpperCase()}  ${c.t} Seg.`,fontSize:14,horzAlign:"left",vertAlign:"top"}}),x=n.addLineSeries({color:"#f6483e33",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),T=n.addLineSeries({color:"#f0f8ff8f",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:2}),g=n.addLineSeries({color:"#00ffa521",lineWidth:7,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),A=n.addLineSeries({color:"yellow",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:3}),p=n.addLineSeries({color:"#84ff3d8a",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),O=n.addLineSeries({color:"orange",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),ae=n.addLineSeries({color:"#f70776",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),X=n.addLineSeries({color:"#00bbf0",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),Y=n.addLineSeries({color:"#bae8e8",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),n.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:0}),j=n.addLineSeries({color:"yellow",lineWidth:4,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),H=n.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1}),R=n.addLineSeries({color:"#c1c1c1",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,priceLineWidth:!1,crosshairMarkerVisible:!1,lineStyle:1})},ie=async s=>(B.value=parseInt((s.time-new Date().getTime())/1e3),new Promise(async(l,e)=>{s==null&&(console.log("#",s),e("undefined lastCandle"));const r=c.micro===!0&&c.t,o=r?u:a.chart.data;let t=JSON.parse(JSON.stringify(o));if(!(t.length<=15)){if(t[t.length-1].close=s.close,t[t.length-1].high=s.high,t[t.length-1].low=s.low,!r){const h=t.flatMap(b=>b.close),i=await f.calculoRSI(h);M.value=parseFloat(i[i.length-1]).toFixed(2)}l(M.value)}})),Ve=async(s=!0)=>{D.value=s;const l=a.chart.data.flatMap(i=>i.close),e=await f.calculoRSI(l);let r=f.calcularMACD(l);const o=await f.calculateBollingerBands(l,89,3),t=f.calculateHMA(a.chart.data,10).flatMap(i=>i.value),h=f.calculateHMA(a.chart.data,20).flatMap(i=>i.value);a.chart.data[a.chart.data.length-1].bb||console.log("** noposee BB ",a.chart.data[a.chart.data.length-1],{isMicro:c.micro}),a.chart.data[a.chart.data.length-1].bb=o.pop(),a.chart.data[a.chart.data.length-1].rsi=e.pop(),a.chart.data[a.chart.data.length-1].macd=r.pop(),a.chart.data[a.chart.data.length-1].hma10=t.pop(),a.chart.data[a.chart.data.length-1].hma20=h.pop(),M.value=a.chart.data[a.chart.data.length-1].rsi},Me=()=>{if(x.setData([]),g.setData([]),T.setData([]),!a.chart.indicators.bb)return;const s=a.chart.data.flatMap(i=>{let b={value:i.bb.upper,time:i.time};return i.high>i.bb.upper&&(b.color="#f443369e"),b}),l=a.chart.data.flatMap(i=>{let b={value:i.bb.lower,time:i.time};return i.low<i.bb.lower&&(b.color="#00ffa58a"),b}),e=a.chart.data.flatMap(i=>({value:i.bb.middle,time:i.time}));function r(i,b){return i.time<b.time?-1:i.time>b.time?1:0}const o=s.sort(r),t=l.sort(r),h=e.sort(r);console.log("check order",{dt_orderHigh:o,dt_orderLow:t,dt_orderMiddle:h}),x.setData(o),g.setData(t),T.setData(h)},we=()=>{if(c.micro&&u.length>=20){const s=u.sort((r,o)=>r.time<o.time?-1:r.time>o.time?1:0);console.log("renderHmaMicro",{dataCandlesMicro:u,dtOrdernada:s});const l=f.calculateHMA(s,10);p.setData(l);const e=f.calculateHMA(s,20,"#f70776");O.setData(e)}},De=()=>{if(!c.micro){if(a.chart.data=a.chart.data.sort((s,l)=>s.time<l.time?-1:s.time>l.time?1:0),a.chart.indicators.hma10){const s=a.chart.data.flatMap(l=>({value:l.hma10,time:l.time}));p.setData(s)}if(a.chart.indicators.hma20){const s=a.chart.data.flatMap(l=>({value:l.hma20,time:l.time}));O.setData(s)}if(a.chart.indicators.hma55){const s=f.calculateHMA(a.chart.data,55,"#f70776");ae.setData(s)}if(a.chart.indicators.hma89){const s=f.calculateHMA(a.chart.data,89,"#9896f1");X.setData(s)}if(a.chart.indicators.hma233){const s=f.calculateHMA(a.chart.data,233,"#00bbf0");Y.setData(s)}}},ke=async s=>{d.loading=!0;const l=String(a.getSymbol).toLowerCase(),e=String(s.value).toLowerCase(),r=`${l}@kline_${a.getTemporality}`,o=`${e}@kline_${a.getTemporality}`;console.log("resetMicro",{evt:s}),L.alcista=[],L.bajista=[],F.bajistas=[],F.alcistas=[],u=[],j.setData([]),H.setData([]),R.setData([]),p.setData([]),O.setData([]),X.setData([]),Y.setData([]),n.applyOptions({priceScale:{scaleMargins:{top:.1,bottom:.1}},watermark:{color:"#00ff11",visible:!0,text:`Topacio ${String(a.getSymbol).toUpperCase()}  ${c.t} Seg.`,fontSize:14,horzAlign:"left",vertAlign:"top"}}),_.setData([]),await V.value.send(JSON.stringify({method:"UNSUBSCRIBE",params:[r],id:new Date().getTime()})),await V.value.send(JSON.stringify({method:"SUBSCRIBE",params:[o],id:new Date().getTime()})),d.loading=!1},Ce=async s=>{n.remove(),L.alcista=[],L.bajista=[],F.bajistas=[],F.alcistas=[];const l=String(a.getSymbol).toLowerCase(),e=String(s.value).toLowerCase(),r=`${l}@kline_${a.getTemporality}`,o=`${e}@kline_${a.getTemporality}`;se(),console.log("* changeTarget Candles",{evt:s,symbolsMinuscula:l,previusSocket:r}),V.value&&(V.value.send(JSON.stringify({method:"UNSUBSCRIBE",params:[r],id:new Date().getTime()})),V.value.send(JSON.stringify({method:"SUBSCRIBE",params:[o],id:new Date().getTime()})))},xe=async()=>{const s=String(a.getSymbol).toLowerCase(),l=a.getTemporality;V.value=await new WebSocket(`wss://fstream.binance.com/ws/${s}@kline_${l}`);let e,r=0;V.value.addEventListener("message",async function(o){var h;if(d.loading)return;const t=JSON.parse(o.data);if(o&&(t!=null&&t.s)&&t.result==null&&(t!=null&&t.k)&&(t==null?void 0:t.k)!=null&&((h=t==null?void 0:t.k)==null?void 0:h.i)==a.getTemporality&&String(t.s).toUpperCase()==String(a.getSymbol).toUpperCase()){const i=parseFloat(t.k.c);t.k.T&&parseInt(t.k.T);const b=t.k.x?t.k.x:!1,k=t.k.V?parseFloat(t.k.V):null,{micro:W,t:z}=c;if(W||(e={time:parseInt(t.k.T),open:parseFloat(t.k.o),high:parseFloat(t.k.h),low:parseFloat(t.k.l),close:i,value:i,volume:k},e.close=i,e.value=i,e.volume=k,e.high&&i>e.high&&(e.high=i),e&&e.low&&i<e.low&&(e.low=i),c.micro&&c.t?e.time=parseInt(S.value):e.time=parseInt(t.k.T),e&&e.close&&ie(e)),!w.value&&W==!0&&z&&(S.value=t.E+z*1e3,e={time:S.value,open:parseFloat(i),high:parseFloat(i),low:parseFloat(i),close:i,value:i,volume:k},w.value=!0),b&&!W){const q=a.chart.data[a.chart.data.length-1].time-a.chart.data[a.chart.data.length-2].time;e.time=parseInt(t.k.T)+q,e.open=parseFloat(t.k.o),e.high=parseFloat(t.k.h),e.low=parseFloat(t.k.l),e.close=parseFloat(i),e.volume=k,a.chart.data.push(e),D.value=!0,le()}if(W&&z&&w.value&&(I&&(e.open=parseFloat(i),e.high=parseFloat(i),e.low=parseFloat(i),e.close=i,e.value=i,e.volume=k,I=!1),e.time=S.value,e.close=i,e.value=i,e.volume=k,W===!0&&u.length==0&&(e={time:parseInt(t.k.T),open:i,high:i,low:i,close:i,value:i,volume:k}),i>e.high&&(e.high=i),i<e.low&&(e.low=i),t.E>S.value&&(D.value=!0,I=!0,S.value=t.E+z*1e3,e.time=parseInt(S.value),u.push(JSON.parse(JSON.stringify(e))),u=u.sort((Z,ee)=>ee.time-Z.time).filter((Z,ee,Be)=>ee===Be.findIndex(Ae=>Ae.time===Z.time)),u.length>1&&Te()),e&&e.close&&u.length>1&&ie(e)),t.E>r&&e&&e.time&&n&&_)try{_.update(e)}catch(q){console.log({chart:n,candleSeries:_,e:q})}}r=t.E})},Te=async()=>{we(),Fe(),Ie()},Fe=()=>{if(u.length>=5){const l=u.sort((t,h)=>h.high-t.high),e=u.flatMap(t=>t.close),r=Re.calculate({values:e,period:10}),o=u.slice(5*-1);console.log("calcularDivergenciaMicro",{dtOrdernadaPriceHigh:l,highLast30Candles:o,closeMicro:e,rsi:r})}},le=async()=>{c.micro||(await Ve(),Me(),De(),re(),ye())},Ie=()=>{if(u.length<=5)return;const s=u.sort((h,i)=>h.time-i.time),l=s.length<89?s.length:80,e=f.kernelChannel(s,l,2.5),r=e.flatMap(h=>({time:h.time,value:parseFloat(parseFloat(h.upperChannel).toFixed(4))})),o=e.flatMap(h=>({time:h.time,value:parseFloat(parseFloat(h.lowerChannel).toFixed(4))})),t=e.flatMap(h=>({time:h.time,value:parseFloat(parseFloat(h.smoothedData).toFixed(4))}));j.setData(t),H.setData(r),R.setData(o),console.log({channelData:e,dtOrdernadaPriceHigh:s})},re=()=>{const l=f.kernelChannel(a.chart.data,89,2.5),e=l.flatMap(t=>({time:t.time,value:parseFloat(parseFloat(t.upperChannel).toFixed(4))})),r=l.flatMap(t=>({time:t.time,value:parseFloat(parseFloat(t.lowerChannel).toFixed(4))})),o=l.flatMap((t,h)=>{const i=parseFloat(t.smoothedData)<a.chart.data[h].close?"#A6FF96":"#DA0C81";return{time:t.time,value:parseFloat(parseFloat(t.smoothedData).toFixed(4)),color:i}});j.setData(o),H.setData(e),R.setData(r)},ne=()=>{setTimeout(function(){new Promise((s,l)=>{L.bajista.length>0&&L.bajista.forEach(e=>{let r=n.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});r.setData(e),F.bajistas.push(r)}),L.alcista.length>0&&L.alcista.forEach(e=>{let r=n.addLineSeries({color:"#fff",lineWidth:1,axisLabelVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,lineStyle:0});r.setData(e),F.alcistas.push(r)}),s(!0)})},0)};return(oe=a==null?void 0:a.getIndicators)!=null&&oe.divergences&&c.main&&c.main===!0&&setTimeout(function(){Promise.resolve(te()).then(ne())},0),Ee(()=>a.chart.data,function(s){c.main&&c.main===!0&&(le(),_.setData(a.chart.data),re(),te().then(ne()))}),me(async()=>{await se(),xe()}),Q({chartStore:a,mainStore:d,chartNameId:c.chartNameId,lastRSI:M,changeTarget:Ce,resetMicro:ke}),(s,l)=>Oe((U(),E("div",{id:y.chartNameId,ref:"chartElement",class:"charts-graphy"},[C("div",Ke,[M.value?(U(),E("label",Ge,"RSI:"+K(M.value),1)):he("",!0)]),c.micro?he("",!0):(U(),E("div",Qe,[Xe,He(" "+K(_e.value)+":"+K(Le.value)+":"+K(Se.value),1)]))],8,Je)),[[je,!G(d).loading]])}},N=de(Ye,[["__scopeId","data-v-38efa76b"]]);const ve=y=>(fe("data-v-91a8cfa7"),y=y(),pe(),y),Ze={key:0,class:"charts"},ea={class:"target-symbols"},aa={class:"MainChart"},ta={class:"microSection"},sa={key:1},ia=ve(()=>C("h1",null,"Necesitas al menos 1 fragmento de alguna de las gemas del Meta de Topacio",-1)),la=ve(()=>C("p",{class:"message-info"}," Encuentra alguno de los Nft's de este hermoso proyecto. participa de los difrentes eventos, se parte de la descentralizaciÃ³n. y siguenos en las redes sociales para estar atento y estar participando para los Airdoprs. ",-1)),ra=[ia,la],na={__name:"ChartAgresive",setup(y,{expose:Q}){var x,T;const m=be(),a=ue(),d=Pe(),f=ze(),c=new ge,u=v([]),w=v(null),S=v(null),D=v(null),n=v(null);let _=null;v(!1);const I=d.params&&d.params&&d.params.symbol?d.params.symbol.toString().toUpperCase():"BTCUSDT",M=d.params&&d.params&&d.params.temporality?d.params.temporality.toString().toLocaleLowerCase():"1m";(x=d==null?void 0:d.params)!=null&&x.symbol?m.chart.symbols=String(d.params.symbol).toUpperCase():m.chart.symbols=I,(T=d==null?void 0:d.params)!=null&&T.temporality?m.chart.temporality=d.params.temporality:m.chart.temporality=M;const B=async g=>{_=g.value,w.value&&(a.loading=!0,f.push({name:"agresive:data",params:{symbol:String(_).toLowerCase(),temporality:m.chart.temporality}}),m.chart.symbols=g.value,await w.value.changeTarget(g),m.chart.data=await c.searchData({exchange:m.getExchange,interval:m.getTemporality,symbolsPairs:m.getSymbol,limit:500}),S.value&&await S.value.resetMicro(g),D.value&&await D.value.resetMicro(g),n.value&&await n.value.resetMicro(g),a.loading=!1)},V=async()=>{const A=(await m.searchSymbolsFutures()).flatMap(p=>m.chart.symbols!=p.symbol?{label:p.symbol,value:p.symbol}:{label:p.symbol,value:p.symbol,selected:!0});u.value=A.filter(p=>p.value.includes("USDT")),m.chart.data=await c.searchData({exchange:m.getExchange,interval:m.getTemporality,symbolsPairs:m.getSymbol,limit:500})};return me(async()=>{a.loading=!0,await V(),a.loading=!1}),Q({Candles:N,mainStore:a,dataPairs:u,changeTarget:B}),(g,A)=>{const p=Ne;return G(a).connected&&G(a).web3.nftBalance>0?(U(),E("main",Ze,[C("div",ea,[$(p,{opciones:u.value,onlyLabel:!1,lblPorDefecto:G(m).chart.symbols,onActionChange:B},null,8,["opciones","lblPorDefecto"])]),C("div",aa,[$(N,{"chart-name-id":"chart-main",main:!0,ref_key:"chartMainAgresive",ref:w},null,512)]),C("div",ta,[$(N,{"chart-name-id":"chart-5s",micro:!0,t:5,ref_key:"chartMicro1",ref:S},null,512),$(N,{"chart-name-id":"chart-15s",micro:!0,t:15,ref_key:"chartMicro2",ref:D},null,512),$(N,{"chart-name-id":"chart-30s",micro:!0,t:30,ref_key:"chartMicro3",ref:n},null,512)])])):(U(),E("main",sa,ra))}}},ua=de(na,[["__scopeId","data-v-91a8cfa7"]]);export{ua as default};
