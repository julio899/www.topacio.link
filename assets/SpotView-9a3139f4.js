import{_ as re,r as f,I as O,f as T,a as y,g as x,d as P,t as D,m as E,l as g,y as j,F as N,B as W,K as ce,c as J,w as $,n as C,o as le,k as ue,h as oe,G as de,H as ve,u as me,A as he}from"./index-b1873696.js";import{u as se,C as pe}from"./processDivergence-4d829698.js";import{b as fe,_ as be,C as ge,B as ye,P as _e,E as Ce,S as Se,T as we,D as xe,$ as Le,g as Ve}from"./index-547c8a7d.js";import{I as ae}from"./iconify-fb4c0989.js";import{C as Ie}from"./Candles-d9a9ba84.js";const ke={key:0,class:"container-selector"},Fe={key:0,class:"amount"},$e=["value","placeholder"],De=["onClick"],Be={__name:"SelectorV2",props:{lblPorDefecto:{type:String,required:!1,default:""},displayAmount:{type:Boolean,required:!1,default:!1},onlyLabel:{type:Boolean,default:!1},opciones:{type:Object,default(S){return[]}}},emits:["actionChange"],setup(S,{emit:I}){const k=I,r=S,c=f(""),a=f(!1),u=r.lblPorDefecto,e=O({data:[]});r.lblPorDefecto!==""&&(c.value=r.lblPorDefecto);const i=O({label:"",value:""}),_=n=>{const b=n.target.value.toUpperCase();c.value=b,i.label="SYMBOL",e.data=r.opciones.filter(L=>L.label.includes(b)),a.value=!0},w=()=>{a.value=!a.value},d=n=>{a.value=!1,i.label=n.label,i.value=n.value,c.value=r.onlyLabel&&r.onlyLabel.value==!0?n.label:n.value,!(!n||!n.value)&&k("actionChange",n)},B=n=>{e.data.length==0&&n!==void 0&&(e.data=n);const b=e.data.filter(L=>L.selected);b[0]&&b[0].label&&(c.value=b[0].label)};return r.opciones&&(e.data=r.opciones,B()),T(()=>r.opciones,B),(n,b)=>S.opciones&&S.opciones.length>0&&S.opciones[0].label?(y(),x("div",ke,[P("form",null,[S.displayAmount?(y(),x("span",Fe,D(S.opciones.length),1)):E("",!0),P("input",{class:"chosen-value",type:"text",value:c.value,placeholder:g(u),onInput:_,onClick:w},null,40,$e),e&&e.data?(y(),x("ul",{key:1,class:j({"value-list":!0,open:a.value})},[(y(!0),x(N,null,W(e.data,L=>(y(),x("li",{onClick:F=>d(L)},D(L.label),9,De))),256))],2)):E("",!0)])])):E("",!0)}},H=re(Be,[["__scopeId","data-v-ff981326"]]),Pe=ce({__name:"AutoCompletedComponent",props:["opciones","txt-placeholder"],setup(S){const I=S,k=I.txtPlaceholder,r=f(k),c=I.opciones;return(a,u)=>(y(),J(g(Ve),{modelValue:r.value,"onUpdate:modelValue":u[0]||(u[0]=e=>r.value=e),class:"ComboboxRoot"},{default:$(()=>[C(g(ge),{class:"ComboboxAnchor"},{default:$(()=>[C(g(fe),{class:"ComboboxInput",placeholder:g(k)},null,8,["placeholder"]),C(g(be),null,{default:$(()=>[C(g(ae),{icon:"radix-icons:chevron-down",class:"ComboboxIcon"})]),_:1})]),_:1}),C(g(Le),{class:"ComboboxContent"},{default:$(()=>[C(g(ye),{class:"ComboboxViewport"},{default:$(()=>[C(g(_e),{class:"ComboboxEmpty"}),C(g(Ce),null,{default:$(()=>[(y(!0),x(N,null,W(g(c),(e,i)=>(y(),J(g(Se),{key:i,class:"ComboboxItem",value:e},{default:$(()=>[C(g(we),{class:"ComboboxItemIndicator"},{default:$(()=>[C(g(ae),{icon:"radix-icons:check"})]),_:1}),P("span",null,D(e),1)]),_:2},1032,["value"]))),128)),C(g(xe),{class:"ComboboxSeparator"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});const Me=["id"],te={__name:"Ind",props:{ind:{type:String,required:!0,default:""}},setup(S,{expose:I}){const k=new oe,r=se(),c=S,a=f([]),u=f([]),e=f(null);let i;const _=c.ind==="rsi"?"#19f5eb":c.ind==="cci"?"yellow":"#fff",w=l=>{e.value.applyOptions({watermark:{color:_,visible:!0,text:l,fontSize:14,horzAlign:"left",vertAlign:"top"},crosshair:{mode:0,vertLine:{width:1,color:"#C3BCDB44",style:0,labelBackgroundColor:"#9B7DFF"},horzLine:{color:_,labelBackgroundColor:_}}})},d=async()=>{!e.value||!i||(c.ind==="rsi"&&(A(),i.setData(a.value)),c.ind==="cci"&&M())},B=l=>{var o;e!=null&&e.value&&((o=e==null?void 0:e.value)!=null&&o.resize)&&(l!=null&&l.width)&&(l!=null&&l.height)&&e.value.resize(l.width,l.height)},n=l=>{i!=null&&i.coordinateToPrice&&i.coordinateToPrice(l)},b=l=>{var o;c.ind=="rsi"&&e.value&&((o=e==null?void 0:e.value)!=null&&o.setCrosshairPosition)&&i&&l&&e.value.setCrosshairPosition(l,l.time,i)},L=(l,o)=>{if(o){const v=formato.filter(m=>m.time===o.time);v[0]&&histogramSeries&&e.value.setCrosshairPosition(v[0],o.time,histogramSeries);return}e.value.clearCrosshairPosition()},F=l=>{e.value.timeScale().setVisibleLogicalRange(l)},M=()=>{var l,o;if(u.value=r.chart.data.flatMap(v=>({time:v.time,value:v.cci,color:v!=null&&v.color?v.color:_})),e!=null&&e.value&&c.ind==="cci"&&((l=u==null?void 0:u.value[u.value.length-1])!=null&&l.value)){const v=parseFloat(u.value[u.value.length-1].value).toFixed(2);w(`CCI [mod 89] ${v}`),(o=u.value[u.value.length-1].value)!=null&&o.cciColor&&(u.value[u.value.length-1].value.color=u.value[u.value.length-1].value.cciColor),u.value.sort((m,U)=>m.time-U.time),i.setData(u.value)}},A=async()=>{var l;if(a.value=r.chart.data.flatMap(o=>({time:o.time,value:o.rsi})),console.log(c.ind,"RSI"),e!=null&&e.value&&((l=a==null?void 0:a.value[a.value.length-1])!=null&&l.value)){const o=a.value[a.value.length-1].value;w(`[14] ${String(c.ind).toUpperCase()} ${o}`),i.setData(a.value)}},V=()=>{const l=document.querySelector(`#chart-${c.ind}`);let o=k.getConfigChart(l.offsetWidth,l.offsetHeight);console.log({configChart:o},l.offsetWidth,l.offsetHeight),o.priceLineVisible=!1,o.priceLineColor="transparent",o.lastValueVisible=!1,o.localization={priceFormatter:v=>parseFloat(v).toFixed(2)},o.timeScale.visible=!1,o.lastValueVisible=!0,o.crosshair.mode=2,console.log({configChart:o}),e.value=pe(l,o),i=e.value.addLineSeries({color:_,lineWidth:1,priceLineVisible:!1,lineVisible:!0,crosshairMarkerVisible:!0}),c.ind==="cci"&&i&&(i.createPriceLine({price:100,color:"#26a69a",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:"100"}),i.createPriceLine({price:0,color:"#c1c1c1",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:"0"}),i.createPriceLine({price:-100,color:"#fff",lineWidth:1,lineStyle:1,axisLabelVisible:!0,title:"-100"}))};return T(()=>r.chart.data,function(l){console.log("*ind* cambio Data",{dt:l}),d()}),le(async()=>{console.log("* ind",c.ind),c.ind==="rsi"?(V(),await A()):c.ind==="cci"&&(V(),await M())}),ue(()=>{console.log("desmontado",c.ind),e.value&&(e.value.removeSeries(i),e.value.remove())}),I({resize:B,refresh:d,chart:e,moveChartVisible:F,moveLineY:n,syncCrosshair:L,crossMove:b}),(l,o)=>(y(),x("div",{class:"container-indicator",id:`chart-${S.ind}`},null,8,Me))}};const Ae={class:"charts"},Re={class:"selectors"},Te={key:0},Ee=["onClick"],Je={__name:"SpotView",setup(S,{expose:I}){const k=new oe,r=de(),c=ve(),a=se();me();const u=r.params&&r.params&&r.params.symbol?r.params.symbol.toString().toUpperCase():"BTCUSDT",e=r.params&&r.params&&r.params.temporality?r.params.temporality.toString().toLocaleLowerCase():"4h";a.chart.symbols=u,a.chart.temporality=e;const i=f([]),_=f(null),w=f(null),d=f(null),B=f(0),n=O({rsi:!1,macd:!1,cci:!1}),b=he(()=>{const t=Object.keys(n).filter(h=>n[h]),s={};return t.forEach(h=>{s[h]=n[h]}),s}),L=t=>{var h,p;const s=parseInt(t.logical);t.targetBarraIndex=s,w&&(w!=null&&w.value)&&w.value[0]&&(t!=null&&t.visibleLogicalRange)&&((h=w.value[0])!=null&&h.moveChartVisible)&&(w.value[0].moveChartVisible(t.visibleLogicalRange),w.value[0].crossMove(t.dataPoint)),d&&(d!=null&&d.value)&&d.value[0]&&(t!=null&&t.visibleLogicalRange)&&((p=d.value[0])!=null&&p.moveChartVisible)&&(d.value[0].moveChartVisible(t.visibleLogicalRange),d.value[0].crossMove(t.dataPoint))},F=()=>Object.values(n).filter(h=>h===!0).length,M=f([{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"15m",value:"15m"},{label:"30m",value:"30m"},{label:"1h",value:"1h"},{label:"2h",value:"2h"},{label:"4h",value:"4h"},{label:"6h",value:"6h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"}]),A=f([]),V=f(null),l=f(null),o=f(null),v=f(null),m=O({symbol:u,temporality:e}),U=f(!1),Y=async()=>{a.chart.data=await a.searchClandlesSpot({symbol:m.symbol,temporality:m.temporality})},ne=async()=>{const t=await a.searchSymbolsSpot();i.value=t.flatMap(s=>s.symbol.includes("USDT")?{label:s.symbol,value:s.symbol}:[]),await Y()},q=async t=>{const s=M.value.find(h=>h.label==t.label);s!=null&&s.value?(m.temporality=s.value,a.chart.temporality=m.temporality):(m.symbol=t.value,a.chart.symbols=t.value),c.push({name:"spot:data",params:{symbol:String(m.symbol).toLowerCase(),temporality:a.chart.temporality}}),o.value=null,V.value&&(m!=null&&m.symbol)&&(m!=null&&m.temporality)&&(l.value&&await V.value.send(JSON.stringify({method:"UNSUBSCRIBE",params:[`${String(l.value).toLowerCase()}`],id:1})),l.value=`${String(m.symbol).toLowerCase()}@kline_${a.chart.temporality}`,V.value.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(l.value).toLowerCase()}`],id:1})),await Y())};return window.addEventListener("resize",t=>{var h;const s=document.querySelector(".container-chart-main");(h=_==null?void 0:_.value)!=null&&h.resizeChart&&(s!=null&&s.offsetHeight)&&F()==0&&_.value.resizeChart({height:s.offsetHeight,width:s.offsetWidth,visualViewport:t.target.visualViewport})}),T(()=>"target.symbol",q),T(n,({rsi:t})=>{console.log("indicadores",{rsi:t})}),T(F,t=>{const s=document.querySelector(".container-chart-main").offsetWidth;if(t==0)_.value.resizeChart({height:document.querySelector(".container-chart-main").offsetHeight,width:s});else{const h=t==1?.7:t==2?.6:.5,p=t==1?.3:t==2?.2:.5/t,z=document.querySelector(".container-chart-main").offsetHeight-120*t;console.log({c:t,chartMainHeight:z,anchura:s,porcentajeChartMain:h,porcentajeChartIndicator:p}),_.value.resizeChart({height:z,width:s})}}),le(async()=>{V.value=await new WebSocket("wss://stream.binance.com/ws"),l.value=`${String(m.symbol).toLowerCase()}@kline_1m`,await ne(),V.value.addEventListener("open",async function(t){V.value.send(JSON.stringify({method:"SUBSCRIBE",params:[`${String(l.value).toLowerCase()}`],id:1}))}),V.value.addEventListener("message",async function(t){var s,h;if(t&&t.data&&t.data!='{"result":null,"id":1}')try{const{k:{c:p,s:z,i:Ue,h:G,l:K,x:Q,n:ze,o:X,T:Z,V:ee,v:Oe,t:ie}}=JSON.parse(t.data);if(Q===!0&&(a.chart.data.push({time:parseInt(Z),timeEnd:parseInt(ie),open:parseFloat(X),high:parseFloat(G),low:parseFloat(K),close:parseFloat(p),value:parseFloat(p),volume:parseFloat(ee)}),console.log({x:Q,chartcci:d},"* Cierre de vela",a.chart.data.length,new Date)),o.value=parseFloat(p).toFixed(4),v.value={time:parseInt(Z),open:parseFloat(X),high:parseFloat(G),low:parseFloat(K),close:parseFloat(p),value:parseFloat(p),volume:parseFloat(ee)},a.chart.data[a.chart.data.length-1]){a.chart.data[a.chart.data.length-1].high=v.value.high,a.chart.data[a.chart.data.length-1].low=v.value.low,a.chart.data[a.chart.data.length-1].close=v.value.close;let R=k.calcularCCI(a.chart.data,89);a.chart.data[a.chart.data.length-1].cci=parseFloat(parseFloat(R.pop()).toFixed(2))}if((s=b==null?void 0:b.value)!=null&&s.cci&&b.value.cci===!0){const R=a.chart.data[a.chart.data.length-1].cci>=100?"#00f5d4":a.chart.data[a.chart.data.length-1].cci<=-100?"#ff006e":null;R&&(v.value.color=R,v.value.borderColor=R,v.value.wickColor=R)}d&&(d!=null&&d.value)&&(d!=null&&d.value[0])&&((h=d.value[0])!=null&&h.refresh)&&d.value[0].refresh()}catch(p){console.log({evt:t,e:p})}})}),I({dataCandles:A,isRefresh:U,target:m,SelectorV2:H,dataPairs:i,dataTemporality:M,AutoCompletedComponent:Pe,chartStore:a,cantidadIndicadores:B,chartIndicators:n,activeIndicators:b,cantidadIndicadoresActivos:F,Ind:te}),(t,s)=>(y(),x("main",Ae,[P("aside",null,[P("div",Re,[C(H,{opciones:i.value,onlyLabel:!1,displayAmount:!0,lblPorDefecto:g(a).chart.symbols,class:"spot-selector-symbols",onActionChange:q},null,8,["opciones","lblPorDefecto"]),C(H,{opciones:M.value,onlyLabel:!1,displayAmount:!1,lblPorDefecto:m.temporality,class:"spot-selector-temp",onActionChange:q},null,8,["opciones","lblPorDefecto"])]),o.value?(y(),x("label",Te," PRICE: "+D(o.value),1)):E("",!0),P("pre",null,D(n),1),(y(!0),x(N,null,W(n,(h,p)=>(y(),x("button",{onClick:z=>n[p]=!n[p],class:"btn btn-ind"},D(p),9,Ee))),256)),P("pre",null,D(b.value)+" ["+D(F())+"]",1)]),U.value?E("",!0):(y(),x("section",{key:0,class:j({"container-chart-main":!0,"ind-2":B.value==2})},[C(Ie,{"chart-name-id":"chart-main",main:!0,ref_key:"chartMainSpot",ref:_,"data-candles":A.value,symbol:m.symbol,spot:!0,price:v.value,"chart-indicators":n,onCrosshairMove:L},null,8,["data-candles","symbol","price","chart-indicators"]),(y(!0),x(N,null,W(b.value,(h,p)=>(y(),J(te,{class:j(`indicador c-ind-${F()} ind-${p}`),ind:`${p}`,"data-candles":A.value,ref_for:!0,ref:`chart${p}`},null,8,["class","ind","data-candles"]))),256))],2))]))}};export{Je as default};
